<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/4bc12c1be68739c7.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4bc12c1be68739c7.css" data-n-g=""/><link rel="preload" href="/_next/static/css/8d58b9228ffac9a6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8d58b9228ffac9a6.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-d7b038a63b619762.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-101cfeaa18eb0e64.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5a602b05d6a5b45c.js" defer=""></script><script src="/_next/static/chunks/451-8446afed8f2a81ca.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bid%5D-7b5e07e6b1c54b77.js" defer=""></script><script src="/_next/static/EwuWiZmkeG3lYlO_XC9fM/_buildManifest.js" defer=""></script><script src="/_next/static/EwuWiZmkeG3lYlO_XC9fM/_ssgManifest.js" defer=""></script><script src="/_next/static/EwuWiZmkeG3lYlO_XC9fM/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><style data-emotion="css a6by8m">.css-a6by8m{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;width:100%;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;margin:auto;}</style><div class="MuiGrid-root MuiGrid-container css-a6by8m"><style data-emotion="css d0aeej">.css-d0aeej{background-color:#FFF;color:#222;margin:30px auto;padding:36px;}.css-d0aeej h1,.css-d0aeej h2,.css-d0aeej h3{font-weight:550;}</style><style data-emotion="css vx8k43">.css-vx8k43{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-basis:91.666667%;-ms-flex-preferred-size:91.666667%;flex-basis:91.666667%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:91.666667%;background-color:#FFF;color:#222;margin:30px auto;padding:36px;}@media (min-width:600px){.css-vx8k43{-webkit-flex-basis:91.666667%;-ms-flex-preferred-size:91.666667%;flex-basis:91.666667%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:91.666667%;}}@media (min-width:900px){.css-vx8k43{-webkit-flex-basis:75%;-ms-flex-preferred-size:75%;flex-basis:75%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:75%;}}@media (min-width:1200px){.css-vx8k43{-webkit-flex-basis:75%;-ms-flex-preferred-size:75%;flex-basis:75%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:75%;}}@media (min-width:1536px){.css-vx8k43{-webkit-flex-basis:75%;-ms-flex-preferred-size:75%;flex-basis:75%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:75%;}}.css-vx8k43 h1,.css-vx8k43 h2,.css-vx8k43 h3{font-weight:550;}</style><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-11 MuiGrid-grid-md-9 css-vx8k43"><style data-emotion="css tph460">.css-tph460{padding:15px 0px;border-bottom:1px solid #4682B4;}</style><div class="css-tph460"><style data-emotion="css 1x4m838">.css-1x4m838{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;font-size:26px;font-weight:540;padding-bottom:16px;}</style><p class="MuiTypography-root MuiTypography-body1 css-1x4m838">DockerでPHP（Laravel）+ nginx + MySQLのLEMP環境を構築する</p><style data-emotion="css q5vujz">.css-q5vujz{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;display:inline-block;padding-right:32px;}</style><p class="MuiTypography-root MuiTypography-body2 css-q5vujz"><style data-emotion="css 1eipbkb">.css-1eipbkb{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;font-size:15px;margin-right:4px;vertical-align:middle;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-1eipbkb" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="AccessTimeIcon"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path><path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"></path></svg>投稿日 <!-- -->2022/1/31</p><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-1eipbkb" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LocalOfferIcon"><path d="m21.41 11.58-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"></path></svg><style data-emotion="css 1lc4u9f">.css-1lc4u9f{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;display:inline-block;padding-right:8px;}</style><p class="MuiTypography-root MuiTypography-body2 css-1lc4u9f">#<!-- -->Docker</p><p class="MuiTypography-root MuiTypography-body2 css-1lc4u9f">#<!-- -->Laravel</p><p class="MuiTypography-root MuiTypography-body2 css-1lc4u9f">#<!-- -->PHP</p></div><style data-emotion="css il3arz">.css-il3arz{margin-top:40px;}.css-il3arz a{color:#639bb7;}.css-il3arz a:hover{color:#0b7eb8;-webkit-text-decoration:underline;text-decoration:underline;}</style><div class="css-il3arz"><html><head></head><body><p>Docker, Docker Compose を使って、<code>PHP（Laravel） + nginx + MySQL</code>の<code>LEMP環境</code>を構築する記事です。   <br><br>検索するとDockerfileやdocker-compose.ymlの書き方については色んな方が記事を書いてくださっていて、動く環境を作ること自体は難しくありませんでした。<br><br>ですが、筆者はひとつコンテナを作っては動作確認していくという過程を経てすごく理解が深まったなと思うので、ファイルの書き方だけでなく動作確認したことやその結果を含めて記事に残しておきたいと思います。<br><br>↓　完成後のリポジトリはこちらです。<br><a href="unsafe:[object Object]">https://github.com/hinakonagao/laravel_docker</a><br><br></p><h1 id="hdb194e8fef"> 全体像</h1><p>最終的なディレクトリ構成は以下の通りです。<br><br>全コンテナを管理するdocker-compose.ymlがトップレベルにあり、同じくトップレベルにあるdockerディレクトリ配下に各コンテナのDockerfileや設定ファイルを置いています。</p><pre><code class="hljs">docker_sample/
├── src&nbsp;&nbsp;<span class="hljs-regexp">//</span> Laravelプロジェクトのソースコード
├── docker
│&nbsp;&nbsp;├── app&nbsp;&nbsp;<span class="hljs-regexp">//</span> PHPコンテナ
│&nbsp;&nbsp;│&nbsp;&nbsp;├── Dockerfile
│&nbsp;&nbsp;│&nbsp;&nbsp;└── php.ini
│&nbsp;&nbsp;├── db&nbsp;&nbsp;&nbsp;<span class="hljs-regexp">//</span> MySQLコンテナ
│&nbsp;&nbsp;│&nbsp;&nbsp;├── Dockerfile
│&nbsp;&nbsp;│&nbsp;&nbsp;└── my.cnf
│&nbsp;&nbsp;└── web&nbsp;&nbsp;<span class="hljs-regexp">//</span> nginxコンテナ
│&nbsp;&nbsp;&nbsp;&nbsp;├── Dockerfile
│&nbsp;&nbsp;&nbsp;&nbsp;└── default.conf
└──&nbsp;docker-compose.yml&nbsp;&nbsp;<span class="hljs-regexp">//</span> 全コンテナの管理</code></pre><p><br><br>早速一つずつコンテナを作っていきます。<br></p><h1 id="h949dc20ce4">PHPのコンテナ（Laravelの開発環境）</h1><p>まずはLaravelの開発環境を構築するための、PHPのコンテナを作成します。<br></p><ul><li> docker-compose.ymlへの記述</li><li> PHPコンテナ用のDockerfile</li><li> PHPコンテナ用の設定ファイル（php.ini）</li></ul><p><br>について順に説明します。<br></p><h2 id="hce39c12d7b"> docker-compose.yml（PHP）</h2><p><br>docker-compose.ymlのうち、PHPコンテナについての記述は以下の通りです。<br>※docker-compose.ymlはインデントが意味を持つので注意。</p><pre><code class="hljs"><span class="hljs-symbol">version:</span> <span class="hljs-string">"3.9"</span>
<span class="hljs-symbol">
services:</span>
<span class="hljs-symbol">&nbsp;app:</span>&nbsp;&nbsp;<span class="hljs-comment">// サービス名</span>
<span class="hljs-symbol">&nbsp;&nbsp;build:</span>
<span class="hljs-symbol">&nbsp;&nbsp;&nbsp;context:</span> .
<span class="hljs-symbol">&nbsp;&nbsp;&nbsp;dockerfile:</span> .<span class="hljs-keyword">/docker/</span>app/Dockerfile
<span class="hljs-symbol">&nbsp;&nbsp;volumes:</span>
&nbsp;&nbsp;&nbsp;- .<span class="hljs-keyword">/src/</span>:/app</code></pre><p><br></p><ul><li> <code>version:</code></li></ul><p>&nbsp;&nbsp;これはPHPコンテナについてではなく <code>docker-compose.yml</code> の先頭に書く設定ですが、Composeファイルのバージョンを表しています。  <br>&nbsp;&nbsp;今回は最新の `3.9` を使います。（最新のバージョンは下記の公式サイトを参照）<br>&nbsp;&nbsp;<a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener noreferrer">Compose file</a> <br>&nbsp;&nbsp;&nbsp;</p><ul><li> <code>build:</code>  </li></ul><p>&nbsp;&nbsp;ビルドコンテキストを指定します。</p><ul><li> context：ビルドコンテキスト（buildを実行する場所）の設定</li><li> dockerfile：buildするDockerfileまでのパス（docker-compose.ymlから見た相対パス）</li></ul><p>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;参考記事： <a href="https://qiita.com/sam8helloworld/items/e7fffa9afc82aea68a7a" target="_blank" rel="noopener noreferrer">docker-compose.ymlのbuild設定はとりあえずcontextもdockerfileも埋めとけって話 - Qiita</a> <br>&nbsp;&nbsp;&nbsp;</p><ul><li> <code>volumes:</code>  </li></ul><p>&nbsp;&nbsp;ホスト側の <code>./src/</code>をコンテナ側の <code>/app</code> にマウントするという意味になります。   <br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;※ここで <code>services:</code> の中に書いているこの <code>volumes:</code> は <code>バインドマウント</code> を行っています。    <br>&nbsp;&nbsp;参考記事：<a href="https://qiita.com/y518gaku/items/456f34c317a65a9dae86" target="_blank" rel="noopener noreferrer">Dockerのマウント3種類についてわかったことをまとめる - Qiita</a> <br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;何が起きているかは実際の挙動を見てみた方が分かりやすいと思うので、後ほどまた動作確認します。<br></p><h2 id="h2043ae13c7">Dockerfile（PHP）</h2><p>Dockerfileはテキストファイルであり、Dockerイメージを作り上げるために実行する命令をこのファイルに書きます。<br><br>作成するDockerfileの全文がこちらです。</p><pre><code class="hljs"><span class="hljs-keyword">FROM</span> php:<span class="hljs-number">8.0</span>-fpm

ENV TZ Asia/Tokyo

RUN apt-get update &amp;&amp; \
	apt-get install -y git unzip libzip-dev libicu-dev libonig-dev &amp;&amp; \
	docker-php-ext-install intl pdo_mysql zip bcmath

<span class="hljs-keyword">COPY</span> .<span class="hljs-regexp">/docker/</span>app<span class="hljs-regexp">/php.ini /u</span>sr<span class="hljs-regexp">/local/</span>etc<span class="hljs-regexp">/php/</span>php.ini
<span class="hljs-keyword">COPY</span> --<span class="hljs-keyword">from</span>=composer:<span class="hljs-number">2.0</span> <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/composer /u</span>sr<span class="hljs-regexp">/bin/</span>composer

WORKDIR /app</code></pre><p><br>一つずつ説明します。<br></p><pre><code class="hljs"><span class="hljs-attribute">FROM</span> php:<span class="hljs-number">8</span>.<span class="hljs-number">0</span>-fpm</code></pre><p><br>&nbsp;<code>FROM</code>ではイメージをビルドするためのベースイメージを設定します。  <br>書き方は <code>FROM イメージ名:タグ名</code> です。  <br>ここではDocker HubからPHP公式のイメージをベースとして指定しています。<br><a href="https://hub.docker.com/_/php" target="_blank" rel="noopener noreferrer">Php - Official Image | Docker Hub</a> <br></p><pre><code class="hljs"><span class="hljs-keyword">ENV</span> TZ Asia/Tokyo</code></pre><p><br>&nbsp;<code>ENV</code>はコンテナ内のサーバー環境変数を設定します。  <br></p><pre><code class="hljs">RUN apt-<span class="hljs-built_in">get</span> <span class="hljs-keyword">update</span> &amp;&amp; \
    apt-<span class="hljs-built_in">get</span> install -y git unzip libzip-<span class="hljs-built_in">dev</span> libicu-<span class="hljs-built_in">dev</span> libonig-<span class="hljs-built_in">dev</span> &amp;&amp; \
	docker-php-ext-install intl pdo_mysql zip bcmath</code></pre><p><br>&nbsp;<code>RUN</code> にはコンテナビルド時に実行するコマンドを書きます。  <br>&nbsp;<code>&amp;&amp;</code> で複数のコマンドをつなぎ、 <code>\</code> で改行します。   <br>※ <code>&amp;&amp;</code> と <code>\</code> を使うことで複数コマンドを1レイヤーにまとめることができ、公式でもベストプラクティスのTipsとして挙げられています。   <br><a href="https://www.docker.com/blog/intro-guide-to-dockerfile-best-practices/#:~:text=Tip%20%233%3A%20Identify%20cacheable%20units%20such%20as%20apt%2Dget%20update%20%26%20install" target="_blank" rel="noopener noreferrer">Intro Guide to Dockerfile Best Practices - Docker Blog</a> <br><br><code>apt-get update</code> ：インストール可能なパッケージの「一覧」を更新  <br>&nbsp;<code>apt-get -y install</code>：パッケージをインストール  <br>&nbsp;<code>docker-php-ext-install</code>：PHPの拡張ライブラリをインストール  <br>※Laravelのインストールや開発に必要な（もしくは便利な）パッケージや拡張ライブラリをインストールしています。<br>※試しにこれらを全くインストールせず手順を進めてみると、コンテナを起動することはできますが、その後のLaravelプロジェクトを作成する時に大量のエラーに遭遇しました…（笑）<br></p><pre><code class="hljs"><span class="hljs-keyword">COPY</span> .<span class="hljs-regexp">/docker/</span>app<span class="hljs-regexp">/php.ini /u</span>sr<span class="hljs-regexp">/local/</span>etc<span class="hljs-regexp">/php/</span>php.ini</code></pre><p><br>ローカルで（後ほど）作成する <code>php.ini</code> （PHPの設定ファイル）をDockerコンテナ内にコピーします。  <br>書き方は <code>COPY [ローカル側のパス] [コンテナ側のパス]</code>です。  <br><br>※ローカル側のパスは、Dockerfileから見てではなくbuildコマンドを実行するディレクトリから見た相対パスです。今回はDocker composeを使ってイメージビルドを行うので、docker-compose.ymlから見た相対パスになっています。<br></p><pre><code class="hljs"><span class="hljs-keyword">COPY</span> --<span class="hljs-keyword">from</span>=composer:<span class="hljs-number">2.0</span> <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/composer /u</span>sr<span class="hljs-regexp">/bin/</span>composer</code></pre><p><br>Laravelを使うためComposerをインストールします。<br>この書き方により<strong>マルチステージビルド</strong>という方法でインストールされます。 <br>※マルチステージビルドという方法はイメージの軽量化に役立つようです。 <br>公式ドキュメント：<a href="https://docs.docker.com/develop/develop-images/multistage-build/" target="_blank" rel="noopener noreferrer">Use multi-stage builds</a> <br></p><pre><code class="hljs"><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span></code></pre><p><br>コンテナを起動している時に <code>$ docker-compose exec コンテナ名 bash</code> というコマンドを実行すると、コンテナの中でbashを実行することができるのですが、 <code>WORKDIR</code>はその時のカレントディレクトリを指定しています。   <br></p><h2 id="h559c05704d"> 設定ファイル（php.ini）</h2><p>&nbsp;<code>COPY ./docker/app/php.ini /usr/local/etc/php/php.ini</code> で出てきたPHPの設定ファイル <code>php.ini</code>を作成します。   <br><br>作成したファイルの中身がこちらです。<br></p><pre><code class="hljs"><span class="hljs-attr">zend.exception_ignore_args</span> = <span class="hljs-literal">off</span>
<span class="hljs-attr">expose_php</span> = <span class="hljs-literal">on</span>
<span class="hljs-attr">max_execution_time</span> = <span class="hljs-number">30</span>
<span class="hljs-attr">max_input_vars</span> = <span class="hljs-number">1000</span>
<span class="hljs-attr">upload_max_filesize</span> = <span class="hljs-number">64</span>M
<span class="hljs-attr">post_max_size</span> = <span class="hljs-number">128</span>M
<span class="hljs-attr">memory_limit</span> = <span class="hljs-number">256</span>M
<span class="hljs-attr">error_reporting</span> = E_ALL
<span class="hljs-attr">display_errors</span> = <span class="hljs-literal">on</span>
<span class="hljs-attr">display_startup_errors</span> = <span class="hljs-literal">on</span>
<span class="hljs-attr">log_errors</span> = <span class="hljs-literal">on</span>
<span class="hljs-attr">error_log</span> = /var/log/php/php-error.log
<span class="hljs-attr">default_charset</span> = UTF-<span class="hljs-number">8</span>

<span class="hljs-section">[Date]</span>
<span class="hljs-attr">date.timezone</span> = Asia/Tokyo

<span class="hljs-section">[mysqlnd]</span>
<span class="hljs-attr">mysqlnd.collect_memory_statistics</span> = <span class="hljs-literal">on</span>

<span class="hljs-section">[Assertion]</span>
<span class="hljs-attr">zend.assertions</span> = <span class="hljs-number">1</span>

<span class="hljs-section">[mbstring]</span>
<span class="hljs-attr">mbstring.language</span> = Japanese</code></pre><p><br>こちらの記事の開発用php.iniをまるっとお借りしました。<br>開発用 / 本番用の設定例と、項目ごとの説明も載っていて面白かったので、ぜひご覧ください。<br>参考記事：<a href="https://qiita.com/ucan-lab/items/0d74378e1b9ba81699a9" target="_blank" rel="noopener noreferrer">PHP7.4 ぼくのかんがえたさいきょうのphp.ini - Qiita</a> <br></p><h2 id="h2c3fab92b5"> PHPコンテナを起動する</h2><p><br>ここまででPHPのコンテナの準備が出来たので、実際に起動してみます。<br><br>docker-sompose.ymlのあるディレクトリで以下のコマンドを実行します。<br></p><pre><code class="hljs">$ docker-compose up -d <span class="hljs-comment">--build</span></code></pre><p><br></p><ul><li> <code>docker compose up</code> は <code>docker-compose.yml</code> に定義したサービスを起動します。   </li><li>  <code>-d</code>デタッチド」モードでコンテナを起動します。</li></ul><p>&nbsp;&nbsp;（デフォルトは「アタッチド」モードで全てのコンテナログを画面上に表示する。「デタッチド」モードではバックグラウンドで動作する。）<br>&nbsp;&nbsp;&nbsp;</p><ul><li> <code>--build</code> コンテナの開始前にイメージをビルドします。  </li></ul><p>&nbsp;&nbsp;（特に変更がない場合はキャッシュが使用される。）<br>&nbsp;&nbsp;&nbsp;<br>※ <code>$ docker-compose build</code> → <code>$ docker-compose up -d</code> を順に行うのと同じです。   <br></p><h3 id="hbdb8067534"> 起動したコンテナを確認する</h3><p>以下のコマンドで起動中のコンテナを一覧で確認することができます。<br></p><pre><code class="hljs"><span class="hljs-variable">$</span> docker<span class="hljs-literal">-compose</span> <span class="hljs-built_in">ps</span>

NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMAND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SERVICE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATUS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PORTS
docker_sample<span class="hljs-literal">-app-1</span>&nbsp;&nbsp;<span class="hljs-string">"docker-php-entrypoi…"</span>&nbsp;&nbsp;app&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-number">9000</span>/tcp</code></pre><p><br>STATUSがrunningになっていれば正常に起動しています。<br><br>今はPHPのコンテナしか作っていないので1つだけ表示されていますが、この後nginx, MySQLのコンテナを作り、最終的に3つのコンテナが表示されるようにします。<br><br>ここで今作業しているディレクトリの構成を確認してみます。<br></p><pre><code class="hljs">$ tree
.
├── src&nbsp;&nbsp;<span class="hljs-regexp">//</span> 作成された！
├── docker
│&nbsp;&nbsp;├── app
│&nbsp;&nbsp;│&nbsp;&nbsp;├── Dockerfile
│&nbsp;&nbsp;│&nbsp;&nbsp;└── php.ini
└── docker-compose.yml</code></pre><p><br>するとdocker-compose.ymlに書いたバインドマウントの以下の部分を受けて、コンテナを起動したときに自動でsrcディレクトリが作成されたことが確認できます。（同様にコンテナ内にもappディレクトリが作成されています。）<br></p><pre><code class="hljs">volumes:
&nbsp;- .<span class="hljs-regexp">/src/</span>:/app</code></pre><p><br></p><h3 id="h4353a13706"> コンテナの中に入ってみる</h3><p><br>コンテナを起動中に以下のコマンドを実行すると、コンテナの中に入ってbashを実行することができます。<br></p><pre><code class="hljs">$ docker-compose exec app bash
<span class="hljs-regexp">//</span> appの部分はサービス名を指定する</code></pre><p><br>これで今コンテナの中に入れたので、Dockerfileの記述通りにコンテナが作られているか、またPHP・Composer・インストールした拡張機能が使えるか確認していきます。<br></p><pre><code class="hljs"><span class="hljs-regexp">//</span> Dockerfileの「WORKDIR /app」で指定したカレントディレクトリ通りか確認
[app]:/app$ pwd
/app

<span class="hljs-regexp">//</span> PHPのバージョン確認
[app]:/app$ php -v
PHP <span class="hljs-number">8.0</span>.<span class="hljs-number">15</span> (cli) (built: Jan <span class="hljs-number">26</span> <span class="hljs-number">2022</span> <span class="hljs-number">17</span>:<span class="hljs-number">38</span>:<span class="hljs-number">36</span>) ( NTS )
Copyright (c) The PHP Group
Zend Engine v4.<span class="hljs-number">0.15</span>, Copyright (c) Zend Technologies

<span class="hljs-regexp">//</span> Composerのバージョン確認
[app]:/app$ composer -v
&nbsp;&nbsp;______
&nbsp;<span class="hljs-regexp">/ ____/</span>___&nbsp;____ ___&nbsp;____&nbsp;____&nbsp;________&nbsp;_____
&nbsp;<span class="hljs-regexp">/ /</span>&nbsp;&nbsp;<span class="hljs-regexp">/ __ \/ __ `__ \/ __ \/ __ \/ ___/</span> _ \<span class="hljs-regexp">/ ___/</span>
<span class="hljs-regexp">/ /</span>___<span class="hljs-regexp">/ /</span>_<span class="hljs-regexp">/ /</span> <span class="hljs-regexp">/ /</span> <span class="hljs-regexp">/ /</span> <span class="hljs-regexp">/ /</span>_<span class="hljs-regexp">/ /</span> <span class="hljs-regexp">/_/</span> (__&nbsp;)&nbsp;__<span class="hljs-regexp">/ /</span>
\____<span class="hljs-regexp">/\____/</span>_<span class="hljs-regexp">/ /</span>_<span class="hljs-regexp">/ /</span>_<span class="hljs-regexp">/ .___/</span>\____<span class="hljs-regexp">/____/</span>\___<span class="hljs-regexp">/_/</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-regexp">/_/</span>
Composer version <span class="hljs-number">2.0</span>.<span class="hljs-number">14</span> <span class="hljs-number">2021</span>-<span class="hljs-number">05</span>-<span class="hljs-number">21</span> <span class="hljs-number">17</span>:<span class="hljs-number">03</span>:<span class="hljs-number">37</span>

<span class="hljs-regexp">//</span> gitのバージョン確認
[app]:/app$ git --version
git version <span class="hljs-number">2.30</span>.<span class="hljs-number">2</span>

<span class="hljs-regexp">//</span> インストール済の拡張機能の一覧
[app]:/app$ php -m
[PHP Modules]
bcmath
intl
pdo_mysql
zip
<span class="hljs-regexp">//</span> たくさん出てくるので他は省略

<span class="hljs-regexp">//</span> php.iniがコピー出来ているか確認
[app]:<span class="hljs-regexp">/app$ cat /u</span>sr<span class="hljs-regexp">/local/</span>etc<span class="hljs-regexp">/php/</span>php.ini
zend.exception_ignore_args = off
expose_php = on
max_execution_time = <span class="hljs-number">30</span>
max_input_vars = <span class="hljs-number">1000</span>
upload_max_filesize = <span class="hljs-number">64</span>M
post_max_size = <span class="hljs-number">128</span>M
memory_limit = <span class="hljs-number">256</span>M
error_reporting = E_ALL
display_errors = on
display_startup_errors = on
log_errors = on
error_log = <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/php/</span>php-error.log
default_charset = UTF-<span class="hljs-number">8</span>

[Date]
date.timezone = Asia/Tokyo

[mysqlnd]
mysqlnd.collect_memory_statistics = on

[Assertion]
zend.assertions = <span class="hljs-number">1</span>

[mbstring]
mbstring.language = Japaneseroot@<span class="hljs-number">0</span>e3ba825df88</code></pre><p><br>確認できたのでコンテナを抜けます。<br></p><pre><code class="hljs">$ <span class="hljs-keyword">exit</span>

<span class="hljs-regexp">//</span> もしくは ctrl + d</code></pre><p><br></p><h3 id="hb30552acef"> コンテナの外からコマンドを実行する</h3><p>上記のコンテナの中で実行したコマンドは、 <code>$ docker-compose exec サービス名 実行したいコマンド</code> でコンテナの外から実行することもできます。（コンテナが起動中に限る）  <br></p><h3 id="hbe7ef0b1fb"> バインドマウントの挙動を確認する</h3><p>コンテナの外からコマンドが実行できるという確認も兼ねて、バインドマウントの動きを見る為、試しに以下のコマンドを実行してみます。<br></p><pre><code class="hljs">// コンテナ内の/app配下にファイルを作ってみる
<span class="hljs-meta">$ </span><span class="language-bash">docker-compose <span class="hljs-built_in">exec</span> app <span class="hljs-built_in">touch</span> sample.php</span>
<span class="hljs-meta">$ </span><span class="language-bash">docker-compose <span class="hljs-built_in">exec</span> app <span class="hljs-built_in">pwd</span></span>
/app
<span class="hljs-meta">$ </span><span class="language-bash">docker-compose <span class="hljs-built_in">exec</span> app <span class="hljs-built_in">ls</span></span>
sample.php</code></pre><p><br>コンテナ内の/app配下にファイルを作成しました。<br><br>この/appという場所は、docker-compose.ymlに書いた以下の記述の通りにバインドマウントされています。<br></p><pre><code class="hljs">volumes:
&nbsp;- .<span class="hljs-regexp">/src/</span>:/app</code></pre><p><br>これにより、プロジェクトディレクトリ配下の/srcにもsample.phpが作成されています。<br></p><pre><code class="hljs"><span class="hljs-variable">$</span> <span class="hljs-built_in">ls</span> src
sample.php</code></pre><p><br>以上より、コンテナ内の <code>/app</code> に対して行ったことが、プロジェクトの <code>/src</code> に反映していることが分かりました。   <br><br>では次に <code>/src</code> への変更がコンテナ内の <code>/app</code> に対しても反映するか試してみます。   <br><br>&nbsp;<code>/src/sample.php</code> をエディタで開いてファイルに <code>hello</code> と書きこみ、以下のコマンドを実行します。   <br></p><pre><code class="hljs"><span class="hljs-meta">$ </span><span class="language-bash">docker-compose <span class="hljs-built_in">exec</span> app <span class="hljs-built_in">cat</span> sample.php</span>
hello

// この時permission errorが出たら権限を変更する
<span class="hljs-meta">$ </span><span class="language-bash">sudo <span class="hljs-built_in">chmod</span> -R 777 ./src</span></code></pre><p><br>するとコンテナ内の <code>./app/sample.php</code> も編集されていることがわかります。  <br><br>このようにバインドマウントにより、ホスト側のディレクトリがコンテナ内へマウント出来ていることも確認できました。<br><br>試しに作成したファイルは不要なので消しておきます。<br></p><pre><code class="hljs"><span class="hljs-meta">$ </span><span class="language-bash"><span class="hljs-built_in">rm</span> src/sample.php</span></code></pre><p><br></p><h1 id="h3a503e139b"> nginxのコンテナ（webサーバー）</h1><p>webサーバーとなるnginxのコンテナを作成します。<br><br>PHPコンテナのときと同じく、<br></p><ul><li> docker-compose.ymlへの記述</li><li> nginxコンテナ用のDockerfile</li><li> nginxコンテナ用の設定ファイル（default.conf）</li></ul><p><br>の流れで説明します。<br></p><h2 id="hc888d0dee3"> docker-compose.yml（nginx）</h2><p><br>既に作成しているdocker-compose.ymlに、nginxのコンテナについての部分を追記します。<br></p><pre><code class="hljs"><span class="hljs-symbol">services:</span>
<span class="hljs-symbol">&nbsp;api:</span>

<span class="hljs-comment">// 中略</span>
<span class="hljs-symbol">	
&nbsp;web:</span>&nbsp;&nbsp;<span class="hljs-comment">// サービス名</span>
<span class="hljs-symbol">&nbsp;&nbsp;build:</span>
<span class="hljs-symbol">&nbsp;&nbsp;&nbsp;context:</span> .
<span class="hljs-symbol">&nbsp;&nbsp;&nbsp;dockerfile:</span> .<span class="hljs-keyword">/docker/</span>web/Dockerfile
<span class="hljs-symbol">&nbsp;&nbsp;ports:</span>
&nbsp;&nbsp;&nbsp;- <span class="hljs-number">8081</span>:<span class="hljs-number">80</span>
<span class="hljs-symbol">&nbsp;&nbsp;depends_on:</span>
&nbsp;&nbsp;&nbsp;- app
<span class="hljs-symbol">&nbsp;&nbsp;volumes:</span>
&nbsp;&nbsp;&nbsp;- .<span class="hljs-keyword">/src/</span>:/app</code></pre><p><br>解説していきます。<br></p><ul><li> <code>build:</code> ・<code>volumes:</code>  </li></ul><p>&nbsp;&nbsp;ここはPHPコンテナと同様なので説明は省きます。<br>&nbsp;&nbsp;&nbsp;</p><ul><li><code>ports:</code>  </li></ul><p>&nbsp;&nbsp;ホスト側とコンテナ間のポート番号の対応付けを設定します。<br>&nbsp;&nbsp;書き方は <code>ホスト側のポート番号 : コンテナのポート番号</code>です。  <br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;※今回ホスト側（自分のPC）は既に他の開発で使っているポートとの兼ね合いで <code>8081</code> を使いました。コンテナ側はnginxのデフォルトのポート番号である <code>80</code> にしています。   <br>&nbsp;&nbsp;&nbsp;</p><ul><li> <code>depends_on:</code>  </li></ul><p>&nbsp;&nbsp;サービスの起動順序を制御します。<br>&nbsp;&nbsp;&nbsp;<code>web</code> の <code>depends_on</code> に <code>app</code> と書いているので、 <code>app</code> → <code>web</code> の順に起動するように指定しています。      <br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;※但しこの記述なしで <code>$ docker-compose up -d --build</code> をしてみても私の環境では全く問題なく動きました。が、サービス同士の依存関係を明示的に記すという意味でも書いておくに越したことはないという判断で書いています。  <br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;※ nginxとphp間でTCPによるfpm接続についてや、<code>depends_on</code> オプションについては以下の記事がすごく勉強になったので是非読んでみてください。  <br>&nbsp;&nbsp;参考記事：<a href="https://qiita.com/haruyanhopemucci/items/344f1e2fb95ed452bdb2#%E5%90%84%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%8C%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E5%90%8D%E3%81%AE%E5%90%8D%E5%89%8D%E8%A7%A3%E6%B1%BA%E3%82%92%E5%BF%85%E8%A6%81%E3%81%A8%E3%81%99%E3%82%8B%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0" target="_blank" rel="noopener noreferrer">【docker-compose】dependsonとサービス名解決にまつわるエトセトラ - Qiita</a> <br></p><h2 id="h5a107e8b8a"> Dockerfile（nginx）</h2><p><br>作成するDockerfileの全文はこちらです。<br></p><pre><code class="hljs"><span class="hljs-keyword">FROM</span> nginx:<span class="hljs-number">1.20</span>-alpine

ENV TZ Asia/Tokyo

<span class="hljs-keyword">COPY</span> .<span class="hljs-regexp">/docker/</span>web<span class="hljs-regexp">/default.conf /</span>etc<span class="hljs-regexp">/nginx/</span>conf.d/<span class="hljs-keyword">default</span>.conf</code></pre><p><br>&nbsp;<code>FROM</code> , <code>ENV</code> , <code>COPY</code> の意味はPHPコンテナのDockerfileと同様なので詳しい説明は省略し、このファイルで設定していることを簡単にまとめます。    <br></p><ul><li> nginx公式のイメージ（Alpineベース）をベースイメージに使用</li></ul><p><a href="https://hub.docker.com/_/nginx" target="_blank" rel="noopener noreferrer">Nginx - Official Image | Docker Hub</a> <br>参考記事：<a href="https://charlie1012.hatenablog.jp/entry/2021/01/14/090000" target="_blank" rel="noopener noreferrer">Dockerでよく利用されているAlpineは他のLinuxディストリビューションと比べて、どれだけ軽量なのか - プログラミングは芸術だ！</a>  <br></p><ul><li> 環境変数のタイムゾーンを設定する</li><li> nginxの設定ファイル（default.conf）をコンテナ内にバインドマウント</li></ul><p><br>※ちなみにnginxは1.18, 1.20などの偶数バージョンが安定バージョンであり、安定バージョンの使用を推奨されています。<br>公式ドキュメント：<a href="https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/#stablevsmainline" target="_blank" rel="noopener noreferrer">Installing NGINX Open Source</a> <br></p><h2 id="h833dd2537f"> 設定ファイル（default.conf）</h2><p><br><code>./docker/web/default.conf</code>を作成します。  <br>Laravel公式に用意されているnginxの設定例をべースに使います。<br><a href="https://readouble.com/laravel/8.x/ja/deployment.html" target="_blank" rel="noopener noreferrer">Laravel 8.x デプロイ</a> <br><br>&nbsp;<code>root</code> と<code>fastcgi_pass</code>の設定のみ、このプロジェクトに合わせて書き換えています。   <br></p><pre><code class="hljs">server {
&nbsp;&nbsp;listen <span class="hljs-number">80</span>;
&nbsp;&nbsp;server_name example.com;
&nbsp;&nbsp;root /app/public;&nbsp;&nbsp;// 書き換え

&nbsp;&nbsp;add_header X-Frame-Options <span class="hljs-string">"SAMEORIGIN"</span>;
&nbsp;&nbsp;add_header X-XSS-Protection <span class="hljs-string">"1; mode=block"</span>;
&nbsp;&nbsp;add_header X-Content-<span class="hljs-keyword">Type</span>-Options <span class="hljs-string">"nosniff"</span>;

&nbsp;&nbsp;index index.php;

&nbsp;&nbsp;charset utf-<span class="hljs-number">8</span>;

&nbsp;&nbsp;<span class="hljs-keyword">location</span> <span class="hljs-title">/ {
&nbsp;&nbsp;&nbsp;&nbsp;try_files</span> $uri $uri/ /index.php?$query_string;
&nbsp;&nbsp;}

&nbsp;&nbsp;<span class="hljs-keyword">location</span> <span class="hljs-title">= /favicon</span>.ico { access_log off; log_not_found off; }
&nbsp;&nbsp;<span class="hljs-keyword">location</span> <span class="hljs-title">= /robots</span>.txt&nbsp;{ access_log off; log_not_found off; }

&nbsp;&nbsp;error_page <span class="hljs-number">404</span> /index.php;

&nbsp;&nbsp;<span class="hljs-keyword">location</span> <span class="hljs-title">~ \.php</span>$ {
&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_pass app:<span class="hljs-number">9000</span>;&nbsp;&nbsp;// 書き換え
&nbsp;&nbsp;&nbsp;&nbsp;fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
&nbsp;&nbsp;&nbsp;&nbsp;include fastcgi_params;
&nbsp;&nbsp;}

&nbsp;&nbsp;<span class="hljs-keyword">location</span> <span class="hljs-title">~ /\.(?!well-known</span>).* {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">deny</span> all;
&nbsp;&nbsp;}
}</code></pre><p><br></p><ul><li> <code>root</code> </li></ul><p>リクエストのルートディレクトリです。<br><code>root /app/public;</code> と書いたので、 <code>localhost:8081</code>（docker-compose.ymlで設定したポート番号）にアクセスすると <code>/app/public</code>を見に行きます。   <br></p><ul><li> <code>fastcgi_pas</code></li></ul><p>FastCGIサーバーのアドレスです。<br>※FastCGI：Webサーバ上で動くプログラムを一度起動したらしばらく待機させることによって、プログラムの開始と終了にかかる手間を減らし、動きを速くしたりWebサーバの負荷を軽減することができる仕組み。<br><code>app:9000;</code> と書いたので、appコンテナの9000番ポートを指定しています。  <br></p><h2 id="hf271decc8d"> nginxコンテナを起動する</h2><p>nginxのコンテナの準備が出来たので、また実際に起動してみます。<br><br>docker-sompose.ymlのあるディレクトリで以下のコマンドを実行します。<br></p><pre><code class="hljs">$ docker-compose up -d <span class="hljs-comment">--build</span>

$ docker-compose ps
NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMAND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SERVICE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATUS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PORTS
docker_sample-app<span class="hljs-number">-1</span>&nbsp;&nbsp;<span class="hljs-string">"docker-php-entrypoi…"</span>&nbsp;&nbsp;app&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">running</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-number">9000</span>/tcp
docker_sample-web<span class="hljs-number">-1</span>&nbsp;&nbsp;<span class="hljs-string">"/docker-entrypoint.…"</span>&nbsp;&nbsp;web&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">running</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">8081</span>-&gt;<span class="hljs-number">80</span>/tcp</code></pre><p><br>api（PHPのコンテナ）、web（nginxのコンテナ）の2つが起動できました。<br><br>またdocker_sample-web-1の <code>PORTS</code> が <code>0.0.0.0:8081-&gt;80/tcp</code> となっており、ホスト上の8081番ポートをコンテナの80番ポートへ割り当てられていることも確認できます。   <br></p><h3 id="h8f15037b6a"> コンテナの動作確認</h3><p><br>nginxのバージョンを確認します。<br></p><pre><code class="hljs"><span class="hljs-meta">$ </span><span class="language-bash">docker-compose <span class="hljs-built_in">exec</span> web nginx -v</span>
nginx version: nginx/1.20.2</code></pre><p><br>コンテナの中に入ってみます。<br></p><pre><code class="hljs">$ docker-compose <span class="hljs-keyword">exec</span> web bash
OCI runtime <span class="hljs-keyword">exec</span> failed: <span class="hljs-keyword">exec</span> failed: container_linux.go:<span class="hljs-number">380</span>: starting <span class="hljs-keyword">container</span> process caused: <span class="hljs-keyword">exec</span>: <span class="hljs-string">"bash"</span>: executable <span class="hljs-keyword">file</span> not found <span class="hljs-keyword">in</span> $PATH: unknown</code></pre><p><br>するとエラーになりました。<br>Alpineをベースとすると <code>bash</code> は使えず、 <code>ash</code> や <code>sh</code> は使えるようです。    <br></p><pre><code class="hljs">$ docker-compose exec web ash
[<span class="hljs-symbol">web</span>]:<span class="hljs-link">/ $ pwd</span>
/</code></pre><p><br>無事コンテナの中に入れました。<br></p><h3 id="h88903227dd"> webサーバーとしての動作確認</h3><p><br></p><ul><li> リクエストに対してファイルを返しブラウザで表示できる</li><li> nginxのコンテナからPHPのコンテナへphpを実行させることができる</li></ul><p><br>上記2点を確認します。<br></p><pre><code class="hljs"><span class="hljs-meta">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> src/public</span>
<span class="hljs-meta">$ </span><span class="language-bash"><span class="hljs-built_in">touch</span> src/public/test.php</span></code></pre><p><br>test.phpを以下のように編集します。<br></p><pre><code class="hljs"><span class="hljs-meta">&lt;?php</span>&nbsp;

<span class="hljs-keyword">echo</span> <span class="hljs-string">'test.phpです'</span>;
<span class="hljs-title function_ invoke__">phpinfo</span>();</code></pre><p><br><code>http://localhost:8081/test.php</code> にアクセスすると以下のように表示され、webサーバーが正しく動作していることが確認できます。  <br><img src="https://images.microcms-assets.io/assets/bb9889e81cb24134954870eb1f2ba680/b84369391f704cafb9636049a0ac8e40/testphp.jpeg" alt=""><br>試しに作成したファイルは不要なので消しておきます。<br></p><pre><code class="hljs"><span class="hljs-variable">$</span> <span class="hljs-built_in">rm</span> <span class="hljs-literal">-rf</span> src/*</code></pre><p><br></p><h1 id="h92f102c3c7"> MySQLのコンテナ（データベース）</h1><p>データベースのMySQLコンテナを作成します。<br><br>以下の流れで説明します。<br></p><ul><li> docker-compose.ymlへの記述</li><li> MySQLコンテナ用のDockerfile</li><li> MySQLコンテナ用の設定ファイル（my.conf）</li></ul><p><br></p><h2 id="h6d7ad88963"> docker-compose.yml（MySQL）</h2><p>既に作成しているdocker-compose.ymlに、MySQLのコンテナについての部分を追記します。<br></p><pre><code class="hljs"><span class="hljs-attribute">services</span><span class="hljs-punctuation">:
	</span>
// 中略

&nbsp;db:&nbsp;&nbsp;// サービス名
&nbsp;&nbsp;<span class="hljs-attribute">build</span><span class="hljs-punctuation">:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">context</span><span class="hljs-punctuation">:</span> <span class="hljs-string">.</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">dockerfile</span><span class="hljs-punctuation">:</span> <span class="hljs-string">./docker/db/Dockerfile</span>
&nbsp;&nbsp;<span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-bullet">-</span> <span class="hljs-string">3306:3306</span>
&nbsp;&nbsp;<span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">MYSQL_DATABASE</span><span class="hljs-punctuation">:</span> <span class="hljs-string">database</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">MYSQL_USER</span><span class="hljs-punctuation">:</span> <span class="hljs-string">user</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">MYSQL_PASSWORD</span><span class="hljs-punctuation">:</span> <span class="hljs-string">password</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">MYSQL_ROOT_PASSWORD</span><span class="hljs-punctuation">:</span> <span class="hljs-string">password</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-attribute">TZ</span><span class="hljs-punctuation">:</span> <span class="hljs-string">'Asia/Tokyo'</span>
&nbsp;&nbsp;<span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-bullet">-</span> <span class="hljs-string">mysql-volume:/var/lib/mysql</span>
&nbsp;&nbsp;&nbsp;&nbsp;
<span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span>
&nbsp;<span class="hljs-attribute">mysql-volume</span><span class="hljs-punctuation">:</span></code></pre><p><br></p><ul><li> <code>build:</code> ・ <code>ports:</code>   </li></ul><p>&nbsp;&nbsp;既出の通りです。<br>&nbsp;&nbsp;&nbsp;</p><ul><li> <code>enviroment:</code>  </li></ul><p>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;環境変数の設定です。<br>&nbsp;&nbsp;※名前やDB名・ユーザー名・パスワードは好きなものを設定します。<br>&nbsp;&nbsp;※実際のプロジェクト管理では、環境変数は <code>.env</code> に書いて <code>.gitignore</code> にするなどして、重要な情報が公開されないようにします。   <br>&nbsp;&nbsp;&nbsp;</p><ul><li> MYSQL_DATABASE：DB名</li><li> MYSQL_USER：ユーザー名</li><li> MYSQL_PASSWORD：パスワード</li><li> MYSQL_ROO<em>ROOT</em>WORD：ルート権限のパスワード</li><li> TZ：時間設定（Time Zone）</li></ul><p>&nbsp;&nbsp;&nbsp;</p><ul><li> <code>volumes:</code>  </li></ul><p>&nbsp;&nbsp;考え方はPHPやnginxのコンテナ同様ですが、先ほどまではホスト側のディレクトリを書いていたところに <code>mysql-volume</code> と書いています。  <br>&nbsp;&nbsp;これにより `mysql-colume` という名前で作成した<strong>名前付きボリューム</strong>とコンテナ内を紐づけています。 <br></p><h3 id="h755cef0747"> Docker Volume</h3><p>&nbsp;<code>Volume</code>  とは、<strong>コンテナを破棄してもデータを永続的に保存できる</strong>ように、コンテナ外に提供されているデータの保存領域です。 <br>Dockerの管理下でホスト上にストレージ領域を確保しており、Linux なら <code>/var/lib/docker/volumes/</code>以下にあります。  <br>参考記事：<a href="unsafe:Volume">Docker、ボリューム(Volume)について真面目に調べた - Qiita</a> <br><br>&nbsp;<strong>なぜVolumeが必要なのか？</strong> <br>コンテナが起動している間はDBのレコードは保存された状態が続きますが、例えば以下のようなコマンドでコンテナを新しく作り直したとするとデータベースの情報はゼロに戻ってしまいます。<br></p><pre><code class="hljs"><span class="hljs-regexp">//</span> コンテナ削除
$ docker-compose down

<span class="hljs-regexp">//</span> コンテナ起動
$ docker-compose up -d</code></pre><p><br>これでは困るのでコンテナを破棄してもデータを残したい、、、というときにVolumesを使ってデータの永続化を行います。<br><br>※ボリュームには名前付きボリュームと匿名ボリュームがありますが、通常は管理しやすい名前付きボリュームを使うと良いかと思います。<br><br>名前付きボリュームを作成する場合は、データの永続化対象のコンテナに対して <code>volumes:</code> オプションでバインドマウントを行うだけでなく、以下のようにdocker-compose.ymlのトップレベルでボリューム名を定義します。  <br></p><pre><code class="hljs"><span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span>
&nbsp;<span class="hljs-bullet">-</span> <span class="hljs-string">mysql-volume:</span></code></pre><p><br></p><h2 id="h7541a8019d"> Dockerfile（MySQL）</h2><p>作成するDockerfileの全文はこちらです。<br></p><pre><code class="hljs"><span class="hljs-keyword">FROM</span> mysql:<span class="hljs-number">8.0</span>

<span class="hljs-keyword">COPY</span> .<span class="hljs-regexp">/docker/</span>db<span class="hljs-regexp">/my.cnf /</span>etc/my.cnf</code></pre><p><br>内容を簡単にまとめると、</p><ul><li> 公式のMySQLイメージをベースイメージに使用</li></ul><p>[Mysql - Official Image | Docker Hub](https://hub.docker.com/_/mysql)</p><ul><li> MySQLの設定ファイル（my.cnf）をコンテナ内にバインドマウント</li></ul><p><br>※ここで使用しているイメージではM1 Macでは動作しないという情報が見られました。どうやらOracleのMySQLチームがメンテしている <code>mysql/mysql-server</code> のイメージだと動作するようです。  <br><a href="https://hub.docker.com/r/mysql/mysql-server" target="_blank" rel="noopener noreferrer">mysql-server&nbsp;| Docker Hub</a> <br></p><h2 id="h1fb4ed6e13"> 設定ファイル（my.conf）</h2><p><code>./docker/db/my.cnf</code>を作成します。  <br><br>色んな記事で作成されているmy.cnfを参考にさせていただきながら書きました。<br>参考記事：<a href="https://it-blue-collar-dairy.com/mysqlondocker-compose/" target="_blank" rel="noopener noreferrer">【Docker】docker-composeでmysqlのコンテナを立てる</a> <br></p><ul><li> 文字コード</li><li> タイムゾーン</li><li> ログ</li></ul><p><br>の設定を行っています。<br></p><pre><code class="hljs"><span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># character</span>
<span class="hljs-attr">character_set_server</span> = utf8mb4
<span class="hljs-attr">collation_server</span> = utf8mb<span class="hljs-number">4_0900_</span>ai_ci

<span class="hljs-comment"># timezone</span>
<span class="hljs-attr">default-time-zone</span> = SYSTEM
<span class="hljs-attr">log_timestamps</span> = SYSTEM

<span class="hljs-comment"># Error Log</span>
<span class="hljs-attr">log-error</span> = mysql-error.log

<span class="hljs-comment"># Slow Query Log</span>
<span class="hljs-attr">slow_query_log</span> = <span class="hljs-number">1</span>
<span class="hljs-attr">slow_query_log_file</span> = mysql-slow.log
<span class="hljs-attr">long_query_time</span> = <span class="hljs-number">1.0</span>
<span class="hljs-attr">log_queries_not_using_indexes</span> = <span class="hljs-number">0</span>

<span class="hljs-comment"># General Log</span>
<span class="hljs-attr">general_log</span> = <span class="hljs-number">1</span>
<span class="hljs-attr">general_log_file</span> = mysql-general.log

<span class="hljs-section">[mysql]</span>
<span class="hljs-attr">default-character-set</span> = utf8mb4

<span class="hljs-section">[client]</span>
<span class="hljs-attr">default-character-set</span> = utf8mb4</code></pre><p><br></p><h2 id="h067ee63297"> MySQLコンテナを起動する</h2><p>MySQLのコンテナの準備が出来たので、また実際に起動してみます。<br><br>docker-sompose.ymlのあるディレクトリで以下のコマンドを実行します。</p><pre><code class="hljs">$ docker-compose up -d <span class="hljs-comment">--build</span>

$ docker-compose ps
NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMAND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SERVICE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATUS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PORTS
docker_sample-app<span class="hljs-number">-1</span>&nbsp;&nbsp;<span class="hljs-string">"docker-php-entrypoi…"</span>&nbsp;&nbsp;app&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">running</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-number">9000</span>/tcp
docker_sample-db<span class="hljs-number">-1</span>&nbsp;&nbsp;<span class="hljs-string">"docker-entrypoint.s…"</span>&nbsp;&nbsp;db&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">running</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">3306</span>-&gt;<span class="hljs-number">3306</span>/tcp
docker_sample-web<span class="hljs-number">-1</span>&nbsp;&nbsp;<span class="hljs-string">"/docker-entrypoint.…"</span>&nbsp;&nbsp;web&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">running</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">8081</span>-&gt;<span class="hljs-number">80</span>/tcp</code></pre><p><br>api（PHPのコンテナ）、web（nginxのコンテナ）、db（MySQLのコンテナ）の3つが起動できました。<br></p><h3 id="h42e7c9d39f">コンテナの動作確認</h3><p>MySQLのバージョンを確認します。<br></p><pre><code class="hljs"><span class="hljs-comment">$ docker compose exec db</span> <span class="hljs-comment">mysql</span> <span class="hljs-literal">-</span><span class="hljs-comment">V</span>
<span class="hljs-comment">mysql&nbsp;Ver</span> <span class="hljs-comment">8</span><span class="hljs-string">.</span><span class="hljs-comment">0</span><span class="hljs-string">.</span><span class="hljs-comment">28 for Linux on x86_64</span> <span class="hljs-comment">(MySQL</span> <span class="hljs-comment">Community</span> <span class="hljs-comment">Server</span> <span class="hljs-literal">-</span> <span class="hljs-comment">GPL)</span></code></pre><p><br>※この後Laravelのプロジェクトを作成したら、このDBとLaravelを接続します。<br>そしてマイグレーションを行ってDBにテーブルを作成してから、MySQLにログインしてDBを使う動作確認をしたいと思います。<br></p><h1 id="hd865058a4e"> Laravelのインストール</h1><h2 id="h6742e995c9"> Laravelプロジェクトの作成</h2><p><br>LEMP環境が構築できたので、Laravelのアプリケーションを作っていきます。<br><br>appコンテナに入り、Laravelをインストールします。<br></p><pre><code class="hljs">$ <span class="hljs-string">docker</span> <span class="hljs-string">compose</span> <span class="hljs-string">exec</span> <span class="hljs-string">app</span> <span class="hljs-string">bash</span>
[<span class="hljs-string">app</span>]:/<span class="hljs-string">app</span>$ <span class="hljs-string">composer</span> <span class="hljs-built_in">create-project</span> <span class="hljs-built_in">--prefer-dist</span> <span class="hljs-string">"laravel/laravel=8.*"</span> .
[<span class="hljs-string">app</span>]:/<span class="hljs-string">app</span>$ <span class="hljs-string">php</span> <span class="hljs-string">artisan</span> -<span class="hljs-string">v</span>
<span class="hljs-string">Laravel</span> <span class="hljs-string">Framework</span> <span class="hljs-string">8</span>.<span class="hljs-string">81</span>.<span class="hljs-string">0</span></code></pre><p><br>コンテナ内の/app配下にLaravelのプロジェクトが新規作成され、ホスト側の/src配下にも同じくLaravelのプロジェクトが出来ました。<br><br><code>localhost:8081</code>にアクセスして、ブラウザでもLaravelのウェルカムページが表示できることを確認します。  <br><img src="https://images.microcms-assets.io/assets/bb9889e81cb24134954870eb1f2ba680/6328bcf6dfe64db7aff89f42adf30e00/laravel.jpeg" alt=""></p><h2 id="h33b0e81c46"> DB接続</h2><p>appコンテナ（Laravel）からdbコンテナ（MySQL）へ接続する設定を行います。<br><br>Laravelではデータベースへの接続設定を <code>.env</code> ファイルに定義しているので、 <code>/src/.env</code> のDBの部分を以下のように修正します。   <br></p><pre><code class="hljs"><span class="hljs-attr">DB_CONNECTION</span>=mysql
<span class="hljs-attr">DB_HOST</span>=db&nbsp;&nbsp;// MySQLコンテナのサービス名
<span class="hljs-attr">DB_PORT</span>=<span class="hljs-number">3306</span>
<span class="hljs-attr">DB_DATABASE</span>=database
<span class="hljs-attr">DB_USERNAME</span>=root
<span class="hljs-attr">DB_PASSWORD</span>=passwor</code></pre><p><br></p><ul><li>  <code>DB_HOST</code>はMySQLコンテナのサービス名を指定します。 </li><li> その他の項目もMySQLコンテナで設定した値（今回はdocker-compose.ymlのenviromentで定義）と同じ値を指定します。</li></ul><p><br>DBに接続出来ているか確認する為、以下のコマンドを実行してマイグレーションを行います。<br></p><pre><code class="hljs">$ docker compose exec app bash
<span class="hljs-section">[app]:/app$ php artisan migrate</span>
Migration table created successfully.
<span class="hljs-section">Migrating: 2014_10_12_000000_create_users_table</span>
<span class="hljs-section">Migrated:&nbsp;2014_10_12_000000_create_users_table (55.42ms)</span>
<span class="hljs-section">Migrating: 2014_10_12_100000_create_password_resets_table</span>
<span class="hljs-section">Migrated:&nbsp;2014_10_12_100000_create_password_resets_table (51.11ms)</span>
<span class="hljs-section">Migrating: 2019_08_19_000000_create_failed_jobs_table</span>
<span class="hljs-section">Migrated:&nbsp;2019_08_19_000000_create_failed_jobs_table (45.12ms)</span>
<span class="hljs-section">Migrating: 2019_12_14_000001_create_personal_access_tokens_table</span>
<span class="hljs-section">Migrated:&nbsp;2019_12_14_000001_create_personal_access_tokens_table (75.74ms)</span></code></pre><p><br></p><h2 id="hf98e955142"> MySQLを使ってみる</h2><p>MySQLのコンテナに入ってDBを確認してみます。<br></p><pre><code class="hljs">$ docker-compose exec db bash
[db]:/$ mysql -u root -p
<span class="hljs-comment">// パスワードを求められるので入力</span>
[db] mysql&gt; use database;
[db] mysql&gt; show tables;
<span class="hljs-code">+------------------------+</span>
<span class="hljs-section">| Tables_in_database&nbsp;&nbsp;&nbsp;|
+------------------------+</span>
| failed<span class="hljs-emphasis">_jobs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
| migrations&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
| password_resets&nbsp;&nbsp;&nbsp;&nbsp;|
| personal_access_</span>tokens |
<span class="hljs-section">| users&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
+------------------------+</span>
5 rows in set (0.00 sec)</code></pre><p><br>先ほどマイグレーションを実行したので、Laravelのデフォルトで用意されているマイグレーションファイル通りにテーブルが作成されていることが確認できました。<br></p><h2 id="h9b4c4b9dd7"> 最後に</h2><p>これでDocker（Docker Compose）を使ったLEMP環境の構築が完了です。<br><br>今回作成した環境は非常にシンプルなものなので、業務で使うとなるともっと設定を細やかに行ったり、開発環境・ステージング環境・本番環境それぞれの設定ファイルを用意して設定を切り替えたりといった作業が必要になるかと思いますが、仕組みが分かればあとは全てこの延長にあるのかなと思います。<br><br>またいずれ環境ごとの設定ファイル切り替えだったり、あとはNodeのコンテナを使ってNext.jsの環境構築もやってみたいです。<br></p><h2 id="h3937880ed1"> 参考記事</h2><p><br><a href="https://yutaro-blog.net/2021/04/29/docker-laravel-vuejs-2/" target="_blank" rel="noopener noreferrer">https://yutaro-blog.net/2021/04/29/docker-laravel-vuejs-2/</a><br><br><a href="https://yutaro-blog.net/2021/04/30/docker-laravel-vuejs-3/#index_id11" target="_blank" rel="noopener noreferrer">https://yutaro-blog.net/2021/04/30/docker-laravel-vuejs-3/#index_id11</a><br><br><a href="https://qiita.com/ucan-lab/items/56c9dc3cf2e6762672f4" target="_blank" rel="noopener noreferrer">https://qiita.com/ucan-lab/items/56c9dc3cf2e6762672f4</a><br></p></body></html></div></div></div><style data-emotion="css 2sbw87">.css-2sbw87{background-color:#494949;margin:0 auto;padding-top:30px;padding-bottom:30px;color:#f2f2f2;letter-spacing:0.08rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-around;-ms-flex-pack:space-around;-webkit-justify-content:space-around;justify-content:space-around;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}</style><div class="css-2sbw87"><style data-emotion="css kta5xp">.css-kta5xp{box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-basis:83.333333%;-ms-flex-preferred-size:83.333333%;flex-basis:83.333333%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:83.333333%;}@media (min-width:600px){.css-kta5xp{-webkit-flex-basis:83.333333%;-ms-flex-preferred-size:83.333333%;flex-basis:83.333333%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:83.333333%;}}@media (min-width:900px){.css-kta5xp{-webkit-flex-basis:66.666667%;-ms-flex-preferred-size:66.666667%;flex-basis:66.666667%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:66.666667%;}}@media (min-width:1200px){.css-kta5xp{-webkit-flex-basis:66.666667%;-ms-flex-preferred-size:66.666667%;flex-basis:66.666667%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:66.666667%;}}@media (min-width:1536px){.css-kta5xp{-webkit-flex-basis:66.666667%;-ms-flex-preferred-size:66.666667%;flex-basis:66.666667%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:66.666667%;}}</style><div class="MuiGrid-root MuiGrid-grid-xs-10 MuiGrid-grid-md-8 css-kta5xp"><style data-emotion="css 1lx0lai">.css-1lx0lai{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;text-align:center;}</style><div class="MuiGrid-root MuiGrid-item css-1lx0lai"><a href="https://twitter.com/napi_nami"><style data-emotion="css 1ea777n">.css-1ea777n{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;margin:8px;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-1ea777n" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="TwitterIcon"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"></path></svg></a><a href="https://github.com/hinakonagao"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-1ea777n" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="GitHubIcon"><path d="M12 1.27a11 11 0 00-3.48 21.46c.55.09.73-.28.73-.55v-1.84c-3.03.64-3.67-1.46-3.67-1.46-.55-1.29-1.28-1.65-1.28-1.65-.92-.65.1-.65.1-.65 1.1 0 1.73 1.1 1.73 1.1.92 1.65 2.57 1.2 3.21.92a2 2 0 01.64-1.47c-2.47-.27-5.04-1.19-5.04-5.5 0-1.1.46-2.1 1.2-2.84a3.76 3.76 0 010-2.93s.91-.28 3.11 1.1c1.8-.49 3.7-.49 5.5 0 2.1-1.38 3.02-1.1 3.02-1.1a3.76 3.76 0 010 2.93c.83.74 1.2 1.74 1.2 2.94 0 4.21-2.57 5.13-5.04 5.4.45.37.82.92.82 2.02v3.03c0 .27.1.64.73.55A11 11 0 0012 1.27"></path></svg></a></div><style data-emotion="css 198jr53">.css-198jr53{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;text-align:center;font-weight:200;}</style><p class="MuiTypography-root MuiTypography-body2 css-198jr53">© 2022 hinako blog</p></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"blog":{"id":"docker-lemp","createdAt":"2022-02-10T12:13:34.104Z","updatedAt":"2022-02-12T10:24:14.756Z","publishedAt":"2022-01-31T12:13:34.000Z","revisedAt":"2022-02-12T10:04:24.386Z","title":"DockerでPHP（Laravel）+ nginx + MySQLのLEMP環境を構築する","body":"\u003cp\u003eDocker, Docker Compose を使って、\u003ccode\u003ePHP（Laravel） + nginx + MySQL\u003c/code\u003eの\u003ccode\u003eLEMP環境\u003c/code\u003eを構築する記事です。   \u003cbr\u003e\u003cbr\u003e検索するとDockerfileやdocker-compose.ymlの書き方については色んな方が記事を書いてくださっていて、動く環境を作ること自体は難しくありませんでした。\u003cbr\u003e\u003cbr\u003eですが、筆者はひとつコンテナを作っては動作確認していくという過程を経てすごく理解が深まったなと思うので、ファイルの書き方だけでなく動作確認したことやその結果を含めて記事に残しておきたいと思います。\u003cbr\u003e\u003cbr\u003e↓　完成後のリポジトリはこちらです。\u003cbr\u003e\u003ca href=\"unsafe:[object Object]\"\u003ehttps://github.com/hinakonagao/laravel_docker\u003c/a\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\u003ch1 id=\"hdb194e8fef\"\u003e 全体像\u003c/h1\u003e\u003cp\u003e最終的なディレクトリ構成は以下の通りです。\u003cbr\u003e\u003cbr\u003e全コンテナを管理するdocker-compose.ymlがトップレベルにあり、同じくトップレベルにあるdockerディレクトリ配下に各コンテナのDockerfileや設定ファイルを置いています。\u003c/p\u003e\u003cpre\u003e\u003ccode\u003edocker_sample/\n├── src\u0026nbsp;\u0026nbsp;// Laravelプロジェクトのソースコード\n├── docker\n│\u0026nbsp;\u0026nbsp;├── app\u0026nbsp;\u0026nbsp;// PHPコンテナ\n│\u0026nbsp;\u0026nbsp;│\u0026nbsp;\u0026nbsp;├── Dockerfile\n│\u0026nbsp;\u0026nbsp;│\u0026nbsp;\u0026nbsp;└── php.ini\n│\u0026nbsp;\u0026nbsp;├── db\u0026nbsp;\u0026nbsp;\u0026nbsp;// MySQLコンテナ\n│\u0026nbsp;\u0026nbsp;│\u0026nbsp;\u0026nbsp;├── Dockerfile\n│\u0026nbsp;\u0026nbsp;│\u0026nbsp;\u0026nbsp;└── my.cnf\n│\u0026nbsp;\u0026nbsp;└── web\u0026nbsp;\u0026nbsp;// nginxコンテナ\n│\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;├── Dockerfile\n│\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;└── default.conf\n└──\u0026nbsp;docker-compose.yml\u0026nbsp;\u0026nbsp;// 全コンテナの管理\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003cbr\u003e早速一つずつコンテナを作っていきます。\u003cbr\u003e\u003c/p\u003e\u003ch1 id=\"h949dc20ce4\"\u003ePHPのコンテナ（Laravelの開発環境）\u003c/h1\u003e\u003cp\u003eまずはLaravelの開発環境を構築するための、PHPのコンテナを作成します。\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e docker-compose.ymlへの記述\u003c/li\u003e\u003cli\u003e PHPコンテナ用のDockerfile\u003c/li\u003e\u003cli\u003e PHPコンテナ用の設定ファイル（php.ini）\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003eについて順に説明します。\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"hce39c12d7b\"\u003e docker-compose.yml（PHP）\u003c/h2\u003e\u003cp\u003e\u003cbr\u003edocker-compose.ymlのうち、PHPコンテナについての記述は以下の通りです。\u003cbr\u003e※docker-compose.ymlはインデントが意味を持つので注意。\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eversion: \"3.9\"\n\nservices:\n\u0026nbsp;app:\u0026nbsp;\u0026nbsp;// サービス名\n\u0026nbsp;\u0026nbsp;build:\n\u0026nbsp;\u0026nbsp;\u0026nbsp;context: .\n\u0026nbsp;\u0026nbsp;\u0026nbsp;dockerfile: ./docker/app/Dockerfile\n\u0026nbsp;\u0026nbsp;volumes:\n\u0026nbsp;\u0026nbsp;\u0026nbsp;- ./src/:/app\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003eversion:\u003c/code\u003e\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;これはPHPコンテナについてではなく \u003ccode\u003edocker-compose.yml\u003c/code\u003e の先頭に書く設定ですが、Composeファイルのバージョンを表しています。  \u003cbr\u003e\u0026nbsp;\u0026nbsp;今回は最新の `3.9` を使います。（最新のバージョンは下記の公式サイトを参照）\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u003ca href=\"https://docs.docker.com/compose/compose-file/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eCompose file\u003c/a\u003e \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003ebuild:\u003c/code\u003e  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;ビルドコンテキストを指定します。\u003c/p\u003e\u003cul\u003e\u003cli\u003e context：ビルドコンテキスト（buildを実行する場所）の設定\u003c/li\u003e\u003cli\u003e dockerfile：buildするDockerfileまでのパス（docker-compose.ymlから見た相対パス）\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;参考記事： \u003ca href=\"https://qiita.com/sam8helloworld/items/e7fffa9afc82aea68a7a\" target=\"_blank\" rel=\"noopener noreferrer\"\u003edocker-compose.ymlのbuild設定はとりあえずcontextもdockerfileも埋めとけって話 - Qiita\u003c/a\u003e \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003evolumes:\u003c/code\u003e  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;ホスト側の \u003ccode\u003e./src/\u003c/code\u003eをコンテナ側の \u003ccode\u003e/app\u003c/code\u003e にマウントするという意味になります。   \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;※ここで \u003ccode\u003eservices:\u003c/code\u003e の中に書いているこの \u003ccode\u003evolumes:\u003c/code\u003e は \u003ccode\u003eバインドマウント\u003c/code\u003e を行っています。    \u003cbr\u003e\u0026nbsp;\u0026nbsp;参考記事：\u003ca href=\"https://qiita.com/y518gaku/items/456f34c317a65a9dae86\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eDockerのマウント3種類についてわかったことをまとめる - Qiita\u003c/a\u003e \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;何が起きているかは実際の挙動を見てみた方が分かりやすいと思うので、後ほどまた動作確認します。\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h2043ae13c7\"\u003eDockerfile（PHP）\u003c/h2\u003e\u003cp\u003eDockerfileはテキストファイルであり、Dockerイメージを作り上げるために実行する命令をこのファイルに書きます。\u003cbr\u003e\u003cbr\u003e作成するDockerfileの全文がこちらです。\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eFROM php:8.0-fpm\n\nENV TZ Asia/Tokyo\n\nRUN apt-get update \u0026amp;\u0026amp; \\\n\tapt-get install -y git unzip libzip-dev libicu-dev libonig-dev \u0026amp;\u0026amp; \\\n\tdocker-php-ext-install intl pdo_mysql zip bcmath\n\nCOPY ./docker/app/php.ini /usr/local/etc/php/php.ini\nCOPY --from=composer:2.0 /usr/bin/composer /usr/bin/composer\n\nWORKDIR /app\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e一つずつ説明します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eFROM php:8.0-fpm\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u0026nbsp;\u003ccode\u003eFROM\u003c/code\u003eではイメージをビルドするためのベースイメージを設定します。  \u003cbr\u003e書き方は \u003ccode\u003eFROM イメージ名:タグ名\u003c/code\u003e です。  \u003cbr\u003eここではDocker HubからPHP公式のイメージをベースとして指定しています。\u003cbr\u003e\u003ca href=\"https://hub.docker.com/_/php\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ePhp - Official Image | Docker Hub\u003c/a\u003e \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eENV TZ Asia/Tokyo\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u0026nbsp;\u003ccode\u003eENV\u003c/code\u003eはコンテナ内のサーバー環境変数を設定します。  \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eRUN apt-get update \u0026amp;\u0026amp; \\\n    apt-get install -y git unzip libzip-dev libicu-dev libonig-dev \u0026amp;\u0026amp; \\\n\tdocker-php-ext-install intl pdo_mysql zip bcmath\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u0026nbsp;\u003ccode\u003eRUN\u003c/code\u003e にはコンテナビルド時に実行するコマンドを書きます。  \u003cbr\u003e\u0026nbsp;\u003ccode\u003e\u0026amp;\u0026amp;\u003c/code\u003e で複数のコマンドをつなぎ、 \u003ccode\u003e\\\u003c/code\u003e で改行します。   \u003cbr\u003e※ \u003ccode\u003e\u0026amp;\u0026amp;\u003c/code\u003e と \u003ccode\u003e\\\u003c/code\u003e を使うことで複数コマンドを1レイヤーにまとめることができ、公式でもベストプラクティスのTipsとして挙げられています。   \u003cbr\u003e\u003ca href=\"https://www.docker.com/blog/intro-guide-to-dockerfile-best-practices/#:~:text=Tip%20%233%3A%20Identify%20cacheable%20units%20such%20as%20apt%2Dget%20update%20%26%20install\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eIntro Guide to Dockerfile Best Practices - Docker Blog\u003c/a\u003e \u003cbr\u003e\u003cbr\u003e\u003ccode\u003eapt-get update\u003c/code\u003e ：インストール可能なパッケージの「一覧」を更新  \u003cbr\u003e\u0026nbsp;\u003ccode\u003eapt-get -y install\u003c/code\u003e：パッケージをインストール  \u003cbr\u003e\u0026nbsp;\u003ccode\u003edocker-php-ext-install\u003c/code\u003e：PHPの拡張ライブラリをインストール  \u003cbr\u003e※Laravelのインストールや開発に必要な（もしくは便利な）パッケージや拡張ライブラリをインストールしています。\u003cbr\u003e※試しにこれらを全くインストールせず手順を進めてみると、コンテナを起動することはできますが、その後のLaravelプロジェクトを作成する時に大量のエラーに遭遇しました…（笑）\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eCOPY ./docker/app/php.ini /usr/local/etc/php/php.ini\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eローカルで（後ほど）作成する \u003ccode\u003ephp.ini\u003c/code\u003e （PHPの設定ファイル）をDockerコンテナ内にコピーします。  \u003cbr\u003e書き方は \u003ccode\u003eCOPY [ローカル側のパス] [コンテナ側のパス]\u003c/code\u003eです。  \u003cbr\u003e\u003cbr\u003e※ローカル側のパスは、Dockerfileから見てではなくbuildコマンドを実行するディレクトリから見た相対パスです。今回はDocker composeを使ってイメージビルドを行うので、docker-compose.ymlから見た相対パスになっています。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eCOPY --from=composer:2.0 /usr/bin/composer /usr/bin/composer\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eLaravelを使うためComposerをインストールします。\u003cbr\u003eこの書き方により\u003cstrong\u003eマルチステージビルド\u003c/strong\u003eという方法でインストールされます。 \u003cbr\u003e※マルチステージビルドという方法はイメージの軽量化に役立つようです。 \u003cbr\u003e公式ドキュメント：\u003ca href=\"https://docs.docker.com/develop/develop-images/multistage-build/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eUse multi-stage builds\u003c/a\u003e \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eWORKDIR /app\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eコンテナを起動している時に \u003ccode\u003e$ docker-compose exec コンテナ名 bash\u003c/code\u003e というコマンドを実行すると、コンテナの中でbashを実行することができるのですが、 \u003ccode\u003eWORKDIR\u003c/code\u003eはその時のカレントディレクトリを指定しています。   \u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h559c05704d\"\u003e 設定ファイル（php.ini）\u003c/h2\u003e\u003cp\u003e\u0026nbsp;\u003ccode\u003eCOPY ./docker/app/php.ini /usr/local/etc/php/php.ini\u003c/code\u003e で出てきたPHPの設定ファイル \u003ccode\u003ephp.ini\u003c/code\u003eを作成します。   \u003cbr\u003e\u003cbr\u003e作成したファイルの中身がこちらです。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003ezend.exception_ignore_args = off\nexpose_php = on\nmax_execution_time = 30\nmax_input_vars = 1000\nupload_max_filesize = 64M\npost_max_size = 128M\nmemory_limit = 256M\nerror_reporting = E_ALL\ndisplay_errors = on\ndisplay_startup_errors = on\nlog_errors = on\nerror_log = /var/log/php/php-error.log\ndefault_charset = UTF-8\n\n[Date]\ndate.timezone = Asia/Tokyo\n\n[mysqlnd]\nmysqlnd.collect_memory_statistics = on\n\n[Assertion]\nzend.assertions = 1\n\n[mbstring]\nmbstring.language = Japanese\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eこちらの記事の開発用php.iniをまるっとお借りしました。\u003cbr\u003e開発用 / 本番用の設定例と、項目ごとの説明も載っていて面白かったので、ぜひご覧ください。\u003cbr\u003e参考記事：\u003ca href=\"https://qiita.com/ucan-lab/items/0d74378e1b9ba81699a9\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ePHP7.4 ぼくのかんがえたさいきょうのphp.ini - Qiita\u003c/a\u003e \u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h2c3fab92b5\"\u003e PHPコンテナを起動する\u003c/h2\u003e\u003cp\u003e\u003cbr\u003eここまででPHPのコンテナの準備が出来たので、実際に起動してみます。\u003cbr\u003e\u003cbr\u003edocker-sompose.ymlのあるディレクトリで以下のコマンドを実行します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ docker-compose up -d --build\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003edocker compose up\u003c/code\u003e は \u003ccode\u003edocker-compose.yml\u003c/code\u003e に定義したサービスを起動します。   \u003c/li\u003e\u003cli\u003e  \u003ccode\u003e-d\u003c/code\u003eデタッチド」モードでコンテナを起動します。\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;（デフォルトは「アタッチド」モードで全てのコンテナログを画面上に表示する。「デタッチド」モードではバックグラウンドで動作する。）\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003e--build\u003c/code\u003e コンテナの開始前にイメージをビルドします。  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;（特に変更がない場合はキャッシュが使用される。）\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e※ \u003ccode\u003e$ docker-compose build\u003c/code\u003e → \u003ccode\u003e$ docker-compose up -d\u003c/code\u003e を順に行うのと同じです。   \u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"hbdb8067534\"\u003e 起動したコンテナを確認する\u003c/h3\u003e\u003cp\u003e以下のコマンドで起動中のコンテナを一覧で確認することができます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ docker-compose ps\n\nNAME\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;COMMAND\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;SERVICE\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;STATUS\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;PORTS\ndocker_sample-app-1\u0026nbsp;\u0026nbsp;\"docker-php-entrypoi…\"\u0026nbsp;\u0026nbsp;app\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;running\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;9000/tcp\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eSTATUSがrunningになっていれば正常に起動しています。\u003cbr\u003e\u003cbr\u003e今はPHPのコンテナしか作っていないので1つだけ表示されていますが、この後nginx, MySQLのコンテナを作り、最終的に3つのコンテナが表示されるようにします。\u003cbr\u003e\u003cbr\u003eここで今作業しているディレクトリの構成を確認してみます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ tree\n.\n├── src\u0026nbsp;\u0026nbsp;// 作成された！\n├── docker\n│\u0026nbsp;\u0026nbsp;├── app\n│\u0026nbsp;\u0026nbsp;│\u0026nbsp;\u0026nbsp;├── Dockerfile\n│\u0026nbsp;\u0026nbsp;│\u0026nbsp;\u0026nbsp;└── php.ini\n└── docker-compose.yml\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eするとdocker-compose.ymlに書いたバインドマウントの以下の部分を受けて、コンテナを起動したときに自動でsrcディレクトリが作成されたことが確認できます。（同様にコンテナ内にもappディレクトリが作成されています。）\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003evolumes:\n\u0026nbsp;- ./src/:/app\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"h4353a13706\"\u003e コンテナの中に入ってみる\u003c/h3\u003e\u003cp\u003e\u003cbr\u003eコンテナを起動中に以下のコマンドを実行すると、コンテナの中に入ってbashを実行することができます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ docker-compose exec app bash\n// appの部分はサービス名を指定する\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eこれで今コンテナの中に入れたので、Dockerfileの記述通りにコンテナが作られているか、またPHP・Composer・インストールした拡張機能が使えるか確認していきます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e// Dockerfileの「WORKDIR /app」で指定したカレントディレクトリ通りか確認\n[app]:/app$ pwd\n/app\n\n// PHPのバージョン確認\n[app]:/app$ php -v\nPHP 8.0.15 (cli) (built: Jan 26 2022 17:38:36) ( NTS )\nCopyright (c) The PHP Group\nZend Engine v4.0.15, Copyright (c) Zend Technologies\n\n// Composerのバージョン確認\n[app]:/app$ composer -v\n\u0026nbsp;\u0026nbsp;______\n\u0026nbsp;/ ____/___\u0026nbsp;____ ___\u0026nbsp;____\u0026nbsp;____\u0026nbsp;________\u0026nbsp;_____\n\u0026nbsp;/ /\u0026nbsp;\u0026nbsp;/ __ \\/ __ `__ \\/ __ \\/ __ \\/ ___/ _ \\/ ___/\n/ /___/ /_/ / / / / / / /_/ / /_/ (__\u0026nbsp;)\u0026nbsp;__/ /\n\\____/\\____/_/ /_/ /_/ .___/\\____/____/\\___/_/\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;/_/\nComposer version 2.0.14 2021-05-21 17:03:37\n\n// gitのバージョン確認\n[app]:/app$ git --version\ngit version 2.30.2\n\n// インストール済の拡張機能の一覧\n[app]:/app$ php -m\n[PHP Modules]\nbcmath\nintl\npdo_mysql\nzip\n// たくさん出てくるので他は省略\n\n// php.iniがコピー出来ているか確認\n[app]:/app$ cat /usr/local/etc/php/php.ini\nzend.exception_ignore_args = off\nexpose_php = on\nmax_execution_time = 30\nmax_input_vars = 1000\nupload_max_filesize = 64M\npost_max_size = 128M\nmemory_limit = 256M\nerror_reporting = E_ALL\ndisplay_errors = on\ndisplay_startup_errors = on\nlog_errors = on\nerror_log = /var/log/php/php-error.log\ndefault_charset = UTF-8\n\n[Date]\ndate.timezone = Asia/Tokyo\n\n[mysqlnd]\nmysqlnd.collect_memory_statistics = on\n\n[Assertion]\nzend.assertions = 1\n\n[mbstring]\nmbstring.language = Japaneseroot@0e3ba825df88\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e確認できたのでコンテナを抜けます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ exit\n\n// もしくは ctrl + d\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"hb30552acef\"\u003e コンテナの外からコマンドを実行する\u003c/h3\u003e\u003cp\u003e上記のコンテナの中で実行したコマンドは、 \u003ccode\u003e$ docker-compose exec サービス名 実行したいコマンド\u003c/code\u003e でコンテナの外から実行することもできます。（コンテナが起動中に限る）  \u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"hbe7ef0b1fb\"\u003e バインドマウントの挙動を確認する\u003c/h3\u003e\u003cp\u003eコンテナの外からコマンドが実行できるという確認も兼ねて、バインドマウントの動きを見る為、試しに以下のコマンドを実行してみます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e// コンテナ内の/app配下にファイルを作ってみる\n$ docker-compose exec app touch sample.php\n$ docker-compose exec app pwd\n/app\n$ docker-compose exec app ls\nsample.php\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eコンテナ内の/app配下にファイルを作成しました。\u003cbr\u003e\u003cbr\u003eこの/appという場所は、docker-compose.ymlに書いた以下の記述の通りにバインドマウントされています。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003evolumes:\n\u0026nbsp;- ./src/:/app\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eこれにより、プロジェクトディレクトリ配下の/srcにもsample.phpが作成されています。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ ls src\nsample.php\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e以上より、コンテナ内の \u003ccode\u003e/app\u003c/code\u003e に対して行ったことが、プロジェクトの \u003ccode\u003e/src\u003c/code\u003e に反映していることが分かりました。   \u003cbr\u003e\u003cbr\u003eでは次に \u003ccode\u003e/src\u003c/code\u003e への変更がコンテナ内の \u003ccode\u003e/app\u003c/code\u003e に対しても反映するか試してみます。   \u003cbr\u003e\u003cbr\u003e\u0026nbsp;\u003ccode\u003e/src/sample.php\u003c/code\u003e をエディタで開いてファイルに \u003ccode\u003ehello\u003c/code\u003e と書きこみ、以下のコマンドを実行します。   \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ docker-compose exec app cat sample.php\nhello\n\n// この時permission errorが出たら権限を変更する\n$ sudo chmod -R 777 ./src\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eするとコンテナ内の \u003ccode\u003e./app/sample.php\u003c/code\u003e も編集されていることがわかります。  \u003cbr\u003e\u003cbr\u003eこのようにバインドマウントにより、ホスト側のディレクトリがコンテナ内へマウント出来ていることも確認できました。\u003cbr\u003e\u003cbr\u003e試しに作成したファイルは不要なので消しておきます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ rm src/sample.php\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch1 id=\"h3a503e139b\"\u003e nginxのコンテナ（webサーバー）\u003c/h1\u003e\u003cp\u003ewebサーバーとなるnginxのコンテナを作成します。\u003cbr\u003e\u003cbr\u003ePHPコンテナのときと同じく、\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e docker-compose.ymlへの記述\u003c/li\u003e\u003cli\u003e nginxコンテナ用のDockerfile\u003c/li\u003e\u003cli\u003e nginxコンテナ用の設定ファイル（default.conf）\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003eの流れで説明します。\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"hc888d0dee3\"\u003e docker-compose.yml（nginx）\u003c/h2\u003e\u003cp\u003e\u003cbr\u003e既に作成しているdocker-compose.ymlに、nginxのコンテナについての部分を追記します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eservices:\n\u0026nbsp;api:\n\n// 中略\n\t\n\u0026nbsp;web:\u0026nbsp;\u0026nbsp;// サービス名\n\u0026nbsp;\u0026nbsp;build:\n\u0026nbsp;\u0026nbsp;\u0026nbsp;context: .\n\u0026nbsp;\u0026nbsp;\u0026nbsp;dockerfile: ./docker/web/Dockerfile\n\u0026nbsp;\u0026nbsp;ports:\n\u0026nbsp;\u0026nbsp;\u0026nbsp;- 8081:80\n\u0026nbsp;\u0026nbsp;depends_on:\n\u0026nbsp;\u0026nbsp;\u0026nbsp;- app\n\u0026nbsp;\u0026nbsp;volumes:\n\u0026nbsp;\u0026nbsp;\u0026nbsp;- ./src/:/app\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e解説していきます。\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003ebuild:\u003c/code\u003e ・\u003ccode\u003evolumes:\u003c/code\u003e  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;ここはPHPコンテナと同様なので説明は省きます。\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e\u003ccode\u003eports:\u003c/code\u003e  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;ホスト側とコンテナ間のポート番号の対応付けを設定します。\u003cbr\u003e\u0026nbsp;\u0026nbsp;書き方は \u003ccode\u003eホスト側のポート番号 : コンテナのポート番号\u003c/code\u003eです。  \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;※今回ホスト側（自分のPC）は既に他の開発で使っているポートとの兼ね合いで \u003ccode\u003e8081\u003c/code\u003e を使いました。コンテナ側はnginxのデフォルトのポート番号である \u003ccode\u003e80\u003c/code\u003e にしています。   \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003edepends_on:\u003c/code\u003e  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;サービスの起動順序を制御します。\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003ccode\u003eweb\u003c/code\u003e の \u003ccode\u003edepends_on\u003c/code\u003e に \u003ccode\u003eapp\u003c/code\u003e と書いているので、 \u003ccode\u003eapp\u003c/code\u003e → \u003ccode\u003eweb\u003c/code\u003e の順に起動するように指定しています。      \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;※但しこの記述なしで \u003ccode\u003e$ docker-compose up -d --build\u003c/code\u003e をしてみても私の環境では全く問題なく動きました。が、サービス同士の依存関係を明示的に記すという意味でも書いておくに越したことはないという判断で書いています。  \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;※ nginxとphp間でTCPによるfpm接続についてや、\u003ccode\u003edepends_on\u003c/code\u003e オプションについては以下の記事がすごく勉強になったので是非読んでみてください。  \u003cbr\u003e\u0026nbsp;\u0026nbsp;参考記事：\u003ca href=\"https://qiita.com/haruyanhopemucci/items/344f1e2fb95ed452bdb2#%E5%90%84%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%8C%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E5%90%8D%E3%81%AE%E5%90%8D%E5%89%8D%E8%A7%A3%E6%B1%BA%E3%82%92%E5%BF%85%E8%A6%81%E3%81%A8%E3%81%99%E3%82%8B%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e【docker-compose】dependsonとサービス名解決にまつわるエトセトラ - Qiita\u003c/a\u003e \u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h5a107e8b8a\"\u003e Dockerfile（nginx）\u003c/h2\u003e\u003cp\u003e\u003cbr\u003e作成するDockerfileの全文はこちらです。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eFROM nginx:1.20-alpine\n\nENV TZ Asia/Tokyo\n\nCOPY ./docker/web/default.conf /etc/nginx/conf.d/default.conf\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u0026nbsp;\u003ccode\u003eFROM\u003c/code\u003e , \u003ccode\u003eENV\u003c/code\u003e , \u003ccode\u003eCOPY\u003c/code\u003e の意味はPHPコンテナのDockerfileと同様なので詳しい説明は省略し、このファイルで設定していることを簡単にまとめます。    \u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e nginx公式のイメージ（Alpineベース）をベースイメージに使用\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003ca href=\"https://hub.docker.com/_/nginx\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eNginx - Official Image | Docker Hub\u003c/a\u003e \u003cbr\u003e参考記事：\u003ca href=\"https://charlie1012.hatenablog.jp/entry/2021/01/14/090000\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eDockerでよく利用されているAlpineは他のLinuxディストリビューションと比べて、どれだけ軽量なのか - プログラミングは芸術だ！\u003c/a\u003e  \u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e 環境変数のタイムゾーンを設定する\u003c/li\u003e\u003cli\u003e nginxの設定ファイル（default.conf）をコンテナ内にバインドマウント\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003e※ちなみにnginxは1.18, 1.20などの偶数バージョンが安定バージョンであり、安定バージョンの使用を推奨されています。\u003cbr\u003e公式ドキュメント：\u003ca href=\"https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/#stablevsmainline\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eInstalling NGINX Open Source\u003c/a\u003e \u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h833dd2537f\"\u003e 設定ファイル（default.conf）\u003c/h2\u003e\u003cp\u003e\u003cbr\u003e\u003ccode\u003e./docker/web/default.conf\u003c/code\u003eを作成します。  \u003cbr\u003eLaravel公式に用意されているnginxの設定例をべースに使います。\u003cbr\u003e\u003ca href=\"https://readouble.com/laravel/8.x/ja/deployment.html\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eLaravel 8.x デプロイ\u003c/a\u003e \u003cbr\u003e\u003cbr\u003e\u0026nbsp;\u003ccode\u003eroot\u003c/code\u003e と\u003ccode\u003efastcgi_pass\u003c/code\u003eの設定のみ、このプロジェクトに合わせて書き換えています。   \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eserver {\n\u0026nbsp;\u0026nbsp;listen 80;\n\u0026nbsp;\u0026nbsp;server_name example.com;\n\u0026nbsp;\u0026nbsp;root /app/public;\u0026nbsp;\u0026nbsp;// 書き換え\n\n\u0026nbsp;\u0026nbsp;add_header X-Frame-Options \"SAMEORIGIN\";\n\u0026nbsp;\u0026nbsp;add_header X-XSS-Protection \"1; mode=block\";\n\u0026nbsp;\u0026nbsp;add_header X-Content-Type-Options \"nosniff\";\n\n\u0026nbsp;\u0026nbsp;index index.php;\n\n\u0026nbsp;\u0026nbsp;charset utf-8;\n\n\u0026nbsp;\u0026nbsp;location / {\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;try_files $uri $uri/ /index.php?$query_string;\n\u0026nbsp;\u0026nbsp;}\n\n\u0026nbsp;\u0026nbsp;location = /favicon.ico { access_log off; log_not_found off; }\n\u0026nbsp;\u0026nbsp;location = /robots.txt\u0026nbsp;{ access_log off; log_not_found off; }\n\n\u0026nbsp;\u0026nbsp;error_page 404 /index.php;\n\n\u0026nbsp;\u0026nbsp;location ~ \\.php$ {\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;fastcgi_pass app:9000;\u0026nbsp;\u0026nbsp;// 書き換え\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;include fastcgi_params;\n\u0026nbsp;\u0026nbsp;}\n\n\u0026nbsp;\u0026nbsp;location ~ /\\.(?!well-known).* {\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;deny all;\n\u0026nbsp;\u0026nbsp;}\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003eroot\u003c/code\u003e \u003c/li\u003e\u003c/ul\u003e\u003cp\u003eリクエストのルートディレクトリです。\u003cbr\u003e\u003ccode\u003eroot /app/public;\u003c/code\u003e と書いたので、 \u003ccode\u003elocalhost:8081\u003c/code\u003e（docker-compose.ymlで設定したポート番号）にアクセスすると \u003ccode\u003e/app/public\u003c/code\u003eを見に行きます。   \u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003efastcgi_pas\u003c/code\u003e\u003c/li\u003e\u003c/ul\u003e\u003cp\u003eFastCGIサーバーのアドレスです。\u003cbr\u003e※FastCGI：Webサーバ上で動くプログラムを一度起動したらしばらく待機させることによって、プログラムの開始と終了にかかる手間を減らし、動きを速くしたりWebサーバの負荷を軽減することができる仕組み。\u003cbr\u003e\u003ccode\u003eapp:9000;\u003c/code\u003e と書いたので、appコンテナの9000番ポートを指定しています。  \u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"hf271decc8d\"\u003e nginxコンテナを起動する\u003c/h2\u003e\u003cp\u003enginxのコンテナの準備が出来たので、また実際に起動してみます。\u003cbr\u003e\u003cbr\u003edocker-sompose.ymlのあるディレクトリで以下のコマンドを実行します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ docker-compose up -d --build\n\n$ docker-compose ps\nNAME\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;COMMAND\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;SERVICE\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;STATUS\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;PORTS\ndocker_sample-app-1\u0026nbsp;\u0026nbsp;\"docker-php-entrypoi…\"\u0026nbsp;\u0026nbsp;app\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;running\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;9000/tcp\ndocker_sample-web-1\u0026nbsp;\u0026nbsp;\"/docker-entrypoint.…\"\u0026nbsp;\u0026nbsp;web\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;running\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;0.0.0.0:8081-\u0026gt;80/tcp\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eapi（PHPのコンテナ）、web（nginxのコンテナ）の2つが起動できました。\u003cbr\u003e\u003cbr\u003eまたdocker_sample-web-1の \u003ccode\u003ePORTS\u003c/code\u003e が \u003ccode\u003e0.0.0.0:8081-\u0026gt;80/tcp\u003c/code\u003e となっており、ホスト上の8081番ポートをコンテナの80番ポートへ割り当てられていることも確認できます。   \u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"h8f15037b6a\"\u003e コンテナの動作確認\u003c/h3\u003e\u003cp\u003e\u003cbr\u003enginxのバージョンを確認します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ docker-compose exec web nginx -v\nnginx version: nginx/1.20.2\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eコンテナの中に入ってみます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ docker-compose exec web bash\nOCI runtime exec failed: exec failed: container_linux.go:380: starting container process caused: exec: \"bash\": executable file not found in $PATH: unknown\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eするとエラーになりました。\u003cbr\u003eAlpineをベースとすると \u003ccode\u003ebash\u003c/code\u003e は使えず、 \u003ccode\u003eash\u003c/code\u003e や \u003ccode\u003esh\u003c/code\u003e は使えるようです。    \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ docker-compose exec web ash\n[web]:/ $ pwd\n/\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e無事コンテナの中に入れました。\u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"h88903227dd\"\u003e webサーバーとしての動作確認\u003c/h3\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e リクエストに対してファイルを返しブラウザで表示できる\u003c/li\u003e\u003cli\u003e nginxのコンテナからPHPのコンテナへphpを実行させることができる\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003e上記2点を確認します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ mkdir src/public\n$ touch src/public/test.php\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003etest.phpを以下のように編集します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\u0026nbsp;\n\necho 'test.phpです';\nphpinfo();\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003ccode\u003ehttp://localhost:8081/test.php\u003c/code\u003e にアクセスすると以下のように表示され、webサーバーが正しく動作していることが確認できます。  \u003cbr\u003e\u003cimg src=\"https://images.microcms-assets.io/assets/bb9889e81cb24134954870eb1f2ba680/b84369391f704cafb9636049a0ac8e40/testphp.jpeg\" alt=\"\"\u003e\u003cbr\u003e試しに作成したファイルは不要なので消しておきます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ rm -rf src/*\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch1 id=\"h92f102c3c7\"\u003e MySQLのコンテナ（データベース）\u003c/h1\u003e\u003cp\u003eデータベースのMySQLコンテナを作成します。\u003cbr\u003e\u003cbr\u003e以下の流れで説明します。\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e docker-compose.ymlへの記述\u003c/li\u003e\u003cli\u003e MySQLコンテナ用のDockerfile\u003c/li\u003e\u003cli\u003e MySQLコンテナ用の設定ファイル（my.conf）\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h6d7ad88963\"\u003e docker-compose.yml（MySQL）\u003c/h2\u003e\u003cp\u003e既に作成しているdocker-compose.ymlに、MySQLのコンテナについての部分を追記します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eservices:\n\t\n// 中略\n\n\u0026nbsp;db:\u0026nbsp;\u0026nbsp;// サービス名\n\u0026nbsp;\u0026nbsp;build:\n\u0026nbsp;\u0026nbsp;\u0026nbsp;context: .\n\u0026nbsp;\u0026nbsp;\u0026nbsp;dockerfile: ./docker/db/Dockerfile\n\u0026nbsp;\u0026nbsp;ports:\n\u0026nbsp;\u0026nbsp;\u0026nbsp;- 3306:3306\n\u0026nbsp;\u0026nbsp;environment:\n\u0026nbsp;\u0026nbsp;\u0026nbsp;MYSQL_DATABASE: database\n\u0026nbsp;\u0026nbsp;\u0026nbsp;MYSQL_USER: user\n\u0026nbsp;\u0026nbsp;\u0026nbsp;MYSQL_PASSWORD: password\n\u0026nbsp;\u0026nbsp;\u0026nbsp;MYSQL_ROOT_PASSWORD: password\n\u0026nbsp;\u0026nbsp;\u0026nbsp;TZ: 'Asia/Tokyo'\n\u0026nbsp;\u0026nbsp;volumes:\n\u0026nbsp;\u0026nbsp;\u0026nbsp;- mysql-volume:/var/lib/mysql\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\nvolumes:\n\u0026nbsp;mysql-volume:\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003ebuild:\u003c/code\u003e ・ \u003ccode\u003eports:\u003c/code\u003e   \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;既出の通りです。\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003eenviroment:\u003c/code\u003e  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;環境変数の設定です。\u003cbr\u003e\u0026nbsp;\u0026nbsp;※名前やDB名・ユーザー名・パスワードは好きなものを設定します。\u003cbr\u003e\u0026nbsp;\u0026nbsp;※実際のプロジェクト管理では、環境変数は \u003ccode\u003e.env\u003c/code\u003e に書いて \u003ccode\u003e.gitignore\u003c/code\u003e にするなどして、重要な情報が公開されないようにします。   \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e MYSQL_DATABASE：DB名\u003c/li\u003e\u003cli\u003e MYSQL_USER：ユーザー名\u003c/li\u003e\u003cli\u003e MYSQL_PASSWORD：パスワード\u003c/li\u003e\u003cli\u003e MYSQL_ROO\u003cem\u003eROOT\u003c/em\u003eWORD：ルート権限のパスワード\u003c/li\u003e\u003cli\u003e TZ：時間設定（Time Zone）\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003evolumes:\u003c/code\u003e  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;考え方はPHPやnginxのコンテナ同様ですが、先ほどまではホスト側のディレクトリを書いていたところに \u003ccode\u003emysql-volume\u003c/code\u003e と書いています。  \u003cbr\u003e\u0026nbsp;\u0026nbsp;これにより `mysql-colume` という名前で作成した\u003cstrong\u003e名前付きボリューム\u003c/strong\u003eとコンテナ内を紐づけています。 \u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"h755cef0747\"\u003e Docker Volume\u003c/h3\u003e\u003cp\u003e\u0026nbsp;\u003ccode\u003eVolume\u003c/code\u003e  とは、\u003cstrong\u003eコンテナを破棄してもデータを永続的に保存できる\u003c/strong\u003eように、コンテナ外に提供されているデータの保存領域です。 \u003cbr\u003eDockerの管理下でホスト上にストレージ領域を確保しており、Linux なら \u003ccode\u003e/var/lib/docker/volumes/\u003c/code\u003e以下にあります。  \u003cbr\u003e参考記事：\u003ca href=\"unsafe:Volume\"\u003eDocker、ボリューム(Volume)について真面目に調べた - Qiita\u003c/a\u003e \u003cbr\u003e\u003cbr\u003e\u0026nbsp;\u003cstrong\u003eなぜVolumeが必要なのか？\u003c/strong\u003e \u003cbr\u003eコンテナが起動している間はDBのレコードは保存された状態が続きますが、例えば以下のようなコマンドでコンテナを新しく作り直したとするとデータベースの情報はゼロに戻ってしまいます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e// コンテナ削除\n$ docker-compose down\n\n// コンテナ起動\n$ docker-compose up -d\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eこれでは困るのでコンテナを破棄してもデータを残したい、、、というときにVolumesを使ってデータの永続化を行います。\u003cbr\u003e\u003cbr\u003e※ボリュームには名前付きボリュームと匿名ボリュームがありますが、通常は管理しやすい名前付きボリュームを使うと良いかと思います。\u003cbr\u003e\u003cbr\u003e名前付きボリュームを作成する場合は、データの永続化対象のコンテナに対して \u003ccode\u003evolumes:\u003c/code\u003e オプションでバインドマウントを行うだけでなく、以下のようにdocker-compose.ymlのトップレベルでボリューム名を定義します。  \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003evolumes:\n\u0026nbsp;- mysql-volume:\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h7541a8019d\"\u003e Dockerfile（MySQL）\u003c/h2\u003e\u003cp\u003e作成するDockerfileの全文はこちらです。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eFROM mysql:8.0\n\nCOPY ./docker/db/my.cnf /etc/my.cnf\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e内容を簡単にまとめると、\u003c/p\u003e\u003cul\u003e\u003cli\u003e 公式のMySQLイメージをベースイメージに使用\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e[Mysql - Official Image | Docker Hub](https://hub.docker.com/_/mysql)\u003c/p\u003e\u003cul\u003e\u003cli\u003e MySQLの設定ファイル（my.cnf）をコンテナ内にバインドマウント\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003e※ここで使用しているイメージではM1 Macでは動作しないという情報が見られました。どうやらOracleのMySQLチームがメンテしている \u003ccode\u003emysql/mysql-server\u003c/code\u003e のイメージだと動作するようです。  \u003cbr\u003e\u003ca href=\"https://hub.docker.com/r/mysql/mysql-server\" target=\"_blank\" rel=\"noopener noreferrer\"\u003emysql-server\u0026nbsp;| Docker Hub\u003c/a\u003e \u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h1fb4ed6e13\"\u003e 設定ファイル（my.conf）\u003c/h2\u003e\u003cp\u003e\u003ccode\u003e./docker/db/my.cnf\u003c/code\u003eを作成します。  \u003cbr\u003e\u003cbr\u003e色んな記事で作成されているmy.cnfを参考にさせていただきながら書きました。\u003cbr\u003e参考記事：\u003ca href=\"https://it-blue-collar-dairy.com/mysqlondocker-compose/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e【Docker】docker-composeでmysqlのコンテナを立てる\u003c/a\u003e \u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e 文字コード\u003c/li\u003e\u003cli\u003e タイムゾーン\u003c/li\u003e\u003cli\u003e ログ\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003eの設定を行っています。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e[mysqld]\n# character\ncharacter_set_server = utf8mb4\ncollation_server = utf8mb4_0900_ai_ci\n\n# timezone\ndefault-time-zone = SYSTEM\nlog_timestamps = SYSTEM\n\n# Error Log\nlog-error = mysql-error.log\n\n# Slow Query Log\nslow_query_log = 1\nslow_query_log_file = mysql-slow.log\nlong_query_time = 1.0\nlog_queries_not_using_indexes = 0\n\n# General Log\ngeneral_log = 1\ngeneral_log_file = mysql-general.log\n\n[mysql]\ndefault-character-set = utf8mb4\n\n[client]\ndefault-character-set = utf8mb4\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h067ee63297\"\u003e MySQLコンテナを起動する\u003c/h2\u003e\u003cp\u003eMySQLのコンテナの準備が出来たので、また実際に起動してみます。\u003cbr\u003e\u003cbr\u003edocker-sompose.ymlのあるディレクトリで以下のコマンドを実行します。\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ docker-compose up -d --build\n\n$ docker-compose ps\nNAME\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;COMMAND\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;SERVICE\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;STATUS\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;PORTS\ndocker_sample-app-1\u0026nbsp;\u0026nbsp;\"docker-php-entrypoi…\"\u0026nbsp;\u0026nbsp;app\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;running\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;9000/tcp\ndocker_sample-db-1\u0026nbsp;\u0026nbsp;\"docker-entrypoint.s…\"\u0026nbsp;\u0026nbsp;db\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;running\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;0.0.0.0:3306-\u0026gt;3306/tcp\ndocker_sample-web-1\u0026nbsp;\u0026nbsp;\"/docker-entrypoint.…\"\u0026nbsp;\u0026nbsp;web\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;running\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;0.0.0.0:8081-\u0026gt;80/tcp\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eapi（PHPのコンテナ）、web（nginxのコンテナ）、db（MySQLのコンテナ）の3つが起動できました。\u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"h42e7c9d39f\"\u003eコンテナの動作確認\u003c/h3\u003e\u003cp\u003eMySQLのバージョンを確認します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ docker compose exec db mysql -V\nmysql\u0026nbsp;Ver 8.0.28 for Linux on x86_64 (MySQL Community Server - GPL)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e※この後Laravelのプロジェクトを作成したら、このDBとLaravelを接続します。\u003cbr\u003eそしてマイグレーションを行ってDBにテーブルを作成してから、MySQLにログインしてDBを使う動作確認をしたいと思います。\u003cbr\u003e\u003c/p\u003e\u003ch1 id=\"hd865058a4e\"\u003e Laravelのインストール\u003c/h1\u003e\u003ch2 id=\"h6742e995c9\"\u003e Laravelプロジェクトの作成\u003c/h2\u003e\u003cp\u003e\u003cbr\u003eLEMP環境が構築できたので、Laravelのアプリケーションを作っていきます。\u003cbr\u003e\u003cbr\u003eappコンテナに入り、Laravelをインストールします。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ docker compose exec app bash\n[app]:/app$ composer create-project --prefer-dist \"laravel/laravel=8.*\" .\n[app]:/app$ php artisan -v\nLaravel Framework 8.81.0\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eコンテナ内の/app配下にLaravelのプロジェクトが新規作成され、ホスト側の/src配下にも同じくLaravelのプロジェクトが出来ました。\u003cbr\u003e\u003cbr\u003e\u003ccode\u003elocalhost:8081\u003c/code\u003eにアクセスして、ブラウザでもLaravelのウェルカムページが表示できることを確認します。  \u003cbr\u003e\u003cimg src=\"https://images.microcms-assets.io/assets/bb9889e81cb24134954870eb1f2ba680/6328bcf6dfe64db7aff89f42adf30e00/laravel.jpeg\" alt=\"\"\u003e\u003c/p\u003e\u003ch2 id=\"h33b0e81c46\"\u003e DB接続\u003c/h2\u003e\u003cp\u003eappコンテナ（Laravel）からdbコンテナ（MySQL）へ接続する設定を行います。\u003cbr\u003e\u003cbr\u003eLaravelではデータベースへの接続設定を \u003ccode\u003e.env\u003c/code\u003e ファイルに定義しているので、 \u003ccode\u003e/src/.env\u003c/code\u003e のDBの部分を以下のように修正します。   \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eDB_CONNECTION=mysql\nDB_HOST=db\u0026nbsp;\u0026nbsp;// MySQLコンテナのサービス名\nDB_PORT=3306\nDB_DATABASE=database\nDB_USERNAME=root\nDB_PASSWORD=passwor\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e  \u003ccode\u003eDB_HOST\u003c/code\u003eはMySQLコンテナのサービス名を指定します。 \u003c/li\u003e\u003cli\u003e その他の項目もMySQLコンテナで設定した値（今回はdocker-compose.ymlのenviromentで定義）と同じ値を指定します。\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003eDBに接続出来ているか確認する為、以下のコマンドを実行してマイグレーションを行います。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ docker compose exec app bash\n[app]:/app$ php artisan migrate\nMigration table created successfully.\nMigrating: 2014_10_12_000000_create_users_table\nMigrated:\u0026nbsp;2014_10_12_000000_create_users_table (55.42ms)\nMigrating: 2014_10_12_100000_create_password_resets_table\nMigrated:\u0026nbsp;2014_10_12_100000_create_password_resets_table (51.11ms)\nMigrating: 2019_08_19_000000_create_failed_jobs_table\nMigrated:\u0026nbsp;2019_08_19_000000_create_failed_jobs_table (45.12ms)\nMigrating: 2019_12_14_000001_create_personal_access_tokens_table\nMigrated:\u0026nbsp;2019_12_14_000001_create_personal_access_tokens_table (75.74ms)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"hf98e955142\"\u003e MySQLを使ってみる\u003c/h2\u003e\u003cp\u003eMySQLのコンテナに入ってDBを確認してみます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode\u003e$ docker-compose exec db bash\n[db]:/$ mysql -u root -p\n// パスワードを求められるので入力\n[db] mysql\u0026gt; use database;\n[db] mysql\u0026gt; show tables;\n+------------------------+\n| Tables_in_database\u0026nbsp;\u0026nbsp;\u0026nbsp;|\n+------------------------+\n| failed_jobs\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;|\n| migrations\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;|\n| password_resets\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;|\n| personal_access_tokens |\n| users\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;|\n+------------------------+\n5 rows in set (0.00 sec)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e先ほどマイグレーションを実行したので、Laravelのデフォルトで用意されているマイグレーションファイル通りにテーブルが作成されていることが確認できました。\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h9b4c4b9dd7\"\u003e 最後に\u003c/h2\u003e\u003cp\u003eこれでDocker（Docker Compose）を使ったLEMP環境の構築が完了です。\u003cbr\u003e\u003cbr\u003e今回作成した環境は非常にシンプルなものなので、業務で使うとなるともっと設定を細やかに行ったり、開発環境・ステージング環境・本番環境それぞれの設定ファイルを用意して設定を切り替えたりといった作業が必要になるかと思いますが、仕組みが分かればあとは全てこの延長にあるのかなと思います。\u003cbr\u003e\u003cbr\u003eまたいずれ環境ごとの設定ファイル切り替えだったり、あとはNodeのコンテナを使ってNext.jsの環境構築もやってみたいです。\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h3937880ed1\"\u003e 参考記事\u003c/h2\u003e\u003cp\u003e\u003cbr\u003e\u003ca href=\"https://yutaro-blog.net/2021/04/29/docker-laravel-vuejs-2/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ehttps://yutaro-blog.net/2021/04/29/docker-laravel-vuejs-2/\u003c/a\u003e\u003cbr\u003e\u003cbr\u003e\u003ca href=\"https://yutaro-blog.net/2021/04/30/docker-laravel-vuejs-3/#index_id11\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ehttps://yutaro-blog.net/2021/04/30/docker-laravel-vuejs-3/#index_id11\u003c/a\u003e\u003cbr\u003e\u003cbr\u003e\u003ca href=\"https://qiita.com/ucan-lab/items/56c9dc3cf2e6762672f4\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ehttps://qiita.com/ucan-lab/items/56c9dc3cf2e6762672f4\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e","tags":[{"id":"docker","createdAt":"2022-02-12T02:32:18.767Z","updatedAt":"2022-02-12T10:02:36.384Z","publishedAt":"2022-02-12T02:32:18.767Z","revisedAt":"2022-02-12T10:02:36.384Z","tag":"Docker"},{"id":"laravel","createdAt":"2022-01-07T13:17:32.553Z","updatedAt":"2022-02-12T02:31:33.697Z","publishedAt":"2022-01-07T13:17:32.553Z","revisedAt":"2022-01-07T13:17:38.700Z","tag":"Laravel"},{"id":"php","createdAt":"2022-01-07T13:16:36.618Z","updatedAt":"2022-02-12T02:31:46.498Z","publishedAt":"2022-01-07T13:16:36.618Z","revisedAt":"2022-01-07T13:16:36.618Z","tag":"PHP"}],"image":"docker"},"highlightedBody":"\u003chtml\u003e\u003chead\u003e\u003c/head\u003e\u003cbody\u003e\u003cp\u003eDocker, Docker Compose を使って、\u003ccode\u003ePHP（Laravel） + nginx + MySQL\u003c/code\u003eの\u003ccode\u003eLEMP環境\u003c/code\u003eを構築する記事です。   \u003cbr\u003e\u003cbr\u003e検索するとDockerfileやdocker-compose.ymlの書き方については色んな方が記事を書いてくださっていて、動く環境を作ること自体は難しくありませんでした。\u003cbr\u003e\u003cbr\u003eですが、筆者はひとつコンテナを作っては動作確認していくという過程を経てすごく理解が深まったなと思うので、ファイルの書き方だけでなく動作確認したことやその結果を含めて記事に残しておきたいと思います。\u003cbr\u003e\u003cbr\u003e↓　完成後のリポジトリはこちらです。\u003cbr\u003e\u003ca href=\"unsafe:[object Object]\"\u003ehttps://github.com/hinakonagao/laravel_docker\u003c/a\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\u003ch1 id=\"hdb194e8fef\"\u003e 全体像\u003c/h1\u003e\u003cp\u003e最終的なディレクトリ構成は以下の通りです。\u003cbr\u003e\u003cbr\u003e全コンテナを管理するdocker-compose.ymlがトップレベルにあり、同じくトップレベルにあるdockerディレクトリ配下に各コンテナのDockerfileや設定ファイルを置いています。\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003edocker_sample/\n├── src\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e Laravelプロジェクトのソースコード\n├── docker\n│\u0026nbsp;\u0026nbsp;├── app\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e PHPコンテナ\n│\u0026nbsp;\u0026nbsp;│\u0026nbsp;\u0026nbsp;├── Dockerfile\n│\u0026nbsp;\u0026nbsp;│\u0026nbsp;\u0026nbsp;└── php.ini\n│\u0026nbsp;\u0026nbsp;├── db\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e MySQLコンテナ\n│\u0026nbsp;\u0026nbsp;│\u0026nbsp;\u0026nbsp;├── Dockerfile\n│\u0026nbsp;\u0026nbsp;│\u0026nbsp;\u0026nbsp;└── my.cnf\n│\u0026nbsp;\u0026nbsp;└── web\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e nginxコンテナ\n│\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;├── Dockerfile\n│\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;└── default.conf\n└──\u0026nbsp;docker-compose.yml\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e 全コンテナの管理\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003cbr\u003e早速一つずつコンテナを作っていきます。\u003cbr\u003e\u003c/p\u003e\u003ch1 id=\"h949dc20ce4\"\u003ePHPのコンテナ（Laravelの開発環境）\u003c/h1\u003e\u003cp\u003eまずはLaravelの開発環境を構築するための、PHPのコンテナを作成します。\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e docker-compose.ymlへの記述\u003c/li\u003e\u003cli\u003e PHPコンテナ用のDockerfile\u003c/li\u003e\u003cli\u003e PHPコンテナ用の設定ファイル（php.ini）\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003eについて順に説明します。\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"hce39c12d7b\"\u003e docker-compose.yml（PHP）\u003c/h2\u003e\u003cp\u003e\u003cbr\u003edocker-compose.ymlのうち、PHPコンテナについての記述は以下の通りです。\u003cbr\u003e※docker-compose.ymlはインデントが意味を持つので注意。\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-symbol\"\u003eversion:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"3.9\"\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\nservices:\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\u0026nbsp;app:\u003c/span\u003e\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-comment\"\u003e// サービス名\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\u0026nbsp;\u0026nbsp;build:\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;context:\u003c/span\u003e .\n\u003cspan class=\"hljs-symbol\"\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;dockerfile:\u003c/span\u003e .\u003cspan class=\"hljs-keyword\"\u003e/docker/\u003c/span\u003eapp/Dockerfile\n\u003cspan class=\"hljs-symbol\"\u003e\u0026nbsp;\u0026nbsp;volumes:\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;- .\u003cspan class=\"hljs-keyword\"\u003e/src/\u003c/span\u003e:/app\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003eversion:\u003c/code\u003e\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;これはPHPコンテナについてではなく \u003ccode\u003edocker-compose.yml\u003c/code\u003e の先頭に書く設定ですが、Composeファイルのバージョンを表しています。  \u003cbr\u003e\u0026nbsp;\u0026nbsp;今回は最新の `3.9` を使います。（最新のバージョンは下記の公式サイトを参照）\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u003ca href=\"https://docs.docker.com/compose/compose-file/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eCompose file\u003c/a\u003e \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003ebuild:\u003c/code\u003e  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;ビルドコンテキストを指定します。\u003c/p\u003e\u003cul\u003e\u003cli\u003e context：ビルドコンテキスト（buildを実行する場所）の設定\u003c/li\u003e\u003cli\u003e dockerfile：buildするDockerfileまでのパス（docker-compose.ymlから見た相対パス）\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;参考記事： \u003ca href=\"https://qiita.com/sam8helloworld/items/e7fffa9afc82aea68a7a\" target=\"_blank\" rel=\"noopener noreferrer\"\u003edocker-compose.ymlのbuild設定はとりあえずcontextもdockerfileも埋めとけって話 - Qiita\u003c/a\u003e \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003evolumes:\u003c/code\u003e  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;ホスト側の \u003ccode\u003e./src/\u003c/code\u003eをコンテナ側の \u003ccode\u003e/app\u003c/code\u003e にマウントするという意味になります。   \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;※ここで \u003ccode\u003eservices:\u003c/code\u003e の中に書いているこの \u003ccode\u003evolumes:\u003c/code\u003e は \u003ccode\u003eバインドマウント\u003c/code\u003e を行っています。    \u003cbr\u003e\u0026nbsp;\u0026nbsp;参考記事：\u003ca href=\"https://qiita.com/y518gaku/items/456f34c317a65a9dae86\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eDockerのマウント3種類についてわかったことをまとめる - Qiita\u003c/a\u003e \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;何が起きているかは実際の挙動を見てみた方が分かりやすいと思うので、後ほどまた動作確認します。\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h2043ae13c7\"\u003eDockerfile（PHP）\u003c/h2\u003e\u003cp\u003eDockerfileはテキストファイルであり、Dockerイメージを作り上げるために実行する命令をこのファイルに書きます。\u003cbr\u003e\u003cbr\u003e作成するDockerfileの全文がこちらです。\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e php:\u003cspan class=\"hljs-number\"\u003e8.0\u003c/span\u003e-fpm\n\nENV TZ Asia/Tokyo\n\nRUN apt-get update \u0026amp;\u0026amp; \\\n\tapt-get install -y git unzip libzip-dev libicu-dev libonig-dev \u0026amp;\u0026amp; \\\n\tdocker-php-ext-install intl pdo_mysql zip bcmath\n\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e .\u003cspan class=\"hljs-regexp\"\u003e/docker/\u003c/span\u003eapp\u003cspan class=\"hljs-regexp\"\u003e/php.ini /u\u003c/span\u003esr\u003cspan class=\"hljs-regexp\"\u003e/local/\u003c/span\u003eetc\u003cspan class=\"hljs-regexp\"\u003e/php/\u003c/span\u003ephp.ini\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e --\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e=composer:\u003cspan class=\"hljs-number\"\u003e2.0\u003c/span\u003e \u003cspan class=\"hljs-regexp\"\u003e/usr/\u003c/span\u003ebin\u003cspan class=\"hljs-regexp\"\u003e/composer /u\u003c/span\u003esr\u003cspan class=\"hljs-regexp\"\u003e/bin/\u003c/span\u003ecomposer\n\nWORKDIR /app\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e一つずつ説明します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-attribute\"\u003eFROM\u003c/span\u003e php:\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e-fpm\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u0026nbsp;\u003ccode\u003eFROM\u003c/code\u003eではイメージをビルドするためのベースイメージを設定します。  \u003cbr\u003e書き方は \u003ccode\u003eFROM イメージ名:タグ名\u003c/code\u003e です。  \u003cbr\u003eここではDocker HubからPHP公式のイメージをベースとして指定しています。\u003cbr\u003e\u003ca href=\"https://hub.docker.com/_/php\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ePhp - Official Image | Docker Hub\u003c/a\u003e \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-keyword\"\u003eENV\u003c/span\u003e TZ Asia/Tokyo\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u0026nbsp;\u003ccode\u003eENV\u003c/code\u003eはコンテナ内のサーバー環境変数を設定します。  \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003eRUN apt-\u003cspan class=\"hljs-built_in\"\u003eget\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eupdate\u003c/span\u003e \u0026amp;\u0026amp; \\\n    apt-\u003cspan class=\"hljs-built_in\"\u003eget\u003c/span\u003e install -y git unzip libzip-\u003cspan class=\"hljs-built_in\"\u003edev\u003c/span\u003e libicu-\u003cspan class=\"hljs-built_in\"\u003edev\u003c/span\u003e libonig-\u003cspan class=\"hljs-built_in\"\u003edev\u003c/span\u003e \u0026amp;\u0026amp; \\\n\tdocker-php-ext-install intl pdo_mysql zip bcmath\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u0026nbsp;\u003ccode\u003eRUN\u003c/code\u003e にはコンテナビルド時に実行するコマンドを書きます。  \u003cbr\u003e\u0026nbsp;\u003ccode\u003e\u0026amp;\u0026amp;\u003c/code\u003e で複数のコマンドをつなぎ、 \u003ccode\u003e\\\u003c/code\u003e で改行します。   \u003cbr\u003e※ \u003ccode\u003e\u0026amp;\u0026amp;\u003c/code\u003e と \u003ccode\u003e\\\u003c/code\u003e を使うことで複数コマンドを1レイヤーにまとめることができ、公式でもベストプラクティスのTipsとして挙げられています。   \u003cbr\u003e\u003ca href=\"https://www.docker.com/blog/intro-guide-to-dockerfile-best-practices/#:~:text=Tip%20%233%3A%20Identify%20cacheable%20units%20such%20as%20apt%2Dget%20update%20%26%20install\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eIntro Guide to Dockerfile Best Practices - Docker Blog\u003c/a\u003e \u003cbr\u003e\u003cbr\u003e\u003ccode\u003eapt-get update\u003c/code\u003e ：インストール可能なパッケージの「一覧」を更新  \u003cbr\u003e\u0026nbsp;\u003ccode\u003eapt-get -y install\u003c/code\u003e：パッケージをインストール  \u003cbr\u003e\u0026nbsp;\u003ccode\u003edocker-php-ext-install\u003c/code\u003e：PHPの拡張ライブラリをインストール  \u003cbr\u003e※Laravelのインストールや開発に必要な（もしくは便利な）パッケージや拡張ライブラリをインストールしています。\u003cbr\u003e※試しにこれらを全くインストールせず手順を進めてみると、コンテナを起動することはできますが、その後のLaravelプロジェクトを作成する時に大量のエラーに遭遇しました…（笑）\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e .\u003cspan class=\"hljs-regexp\"\u003e/docker/\u003c/span\u003eapp\u003cspan class=\"hljs-regexp\"\u003e/php.ini /u\u003c/span\u003esr\u003cspan class=\"hljs-regexp\"\u003e/local/\u003c/span\u003eetc\u003cspan class=\"hljs-regexp\"\u003e/php/\u003c/span\u003ephp.ini\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eローカルで（後ほど）作成する \u003ccode\u003ephp.ini\u003c/code\u003e （PHPの設定ファイル）をDockerコンテナ内にコピーします。  \u003cbr\u003e書き方は \u003ccode\u003eCOPY [ローカル側のパス] [コンテナ側のパス]\u003c/code\u003eです。  \u003cbr\u003e\u003cbr\u003e※ローカル側のパスは、Dockerfileから見てではなくbuildコマンドを実行するディレクトリから見た相対パスです。今回はDocker composeを使ってイメージビルドを行うので、docker-compose.ymlから見た相対パスになっています。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e --\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e=composer:\u003cspan class=\"hljs-number\"\u003e2.0\u003c/span\u003e \u003cspan class=\"hljs-regexp\"\u003e/usr/\u003c/span\u003ebin\u003cspan class=\"hljs-regexp\"\u003e/composer /u\u003c/span\u003esr\u003cspan class=\"hljs-regexp\"\u003e/bin/\u003c/span\u003ecomposer\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eLaravelを使うためComposerをインストールします。\u003cbr\u003eこの書き方により\u003cstrong\u003eマルチステージビルド\u003c/strong\u003eという方法でインストールされます。 \u003cbr\u003e※マルチステージビルドという方法はイメージの軽量化に役立つようです。 \u003cbr\u003e公式ドキュメント：\u003ca href=\"https://docs.docker.com/develop/develop-images/multistage-build/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eUse multi-stage builds\u003c/a\u003e \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-keyword\"\u003eWORKDIR\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e /app\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eコンテナを起動している時に \u003ccode\u003e$ docker-compose exec コンテナ名 bash\u003c/code\u003e というコマンドを実行すると、コンテナの中でbashを実行することができるのですが、 \u003ccode\u003eWORKDIR\u003c/code\u003eはその時のカレントディレクトリを指定しています。   \u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h559c05704d\"\u003e 設定ファイル（php.ini）\u003c/h2\u003e\u003cp\u003e\u0026nbsp;\u003ccode\u003eCOPY ./docker/app/php.ini /usr/local/etc/php/php.ini\u003c/code\u003e で出てきたPHPの設定ファイル \u003ccode\u003ephp.ini\u003c/code\u003eを作成します。   \u003cbr\u003e\u003cbr\u003e作成したファイルの中身がこちらです。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-attr\"\u003ezend.exception_ignore_args\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003eoff\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eexpose_php\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003eon\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003emax_execution_time\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003emax_input_vars\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eupload_max_filesize\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e64\u003c/span\u003eM\n\u003cspan class=\"hljs-attr\"\u003epost_max_size\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e128\u003c/span\u003eM\n\u003cspan class=\"hljs-attr\"\u003ememory_limit\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e256\u003c/span\u003eM\n\u003cspan class=\"hljs-attr\"\u003eerror_reporting\u003c/span\u003e = E_ALL\n\u003cspan class=\"hljs-attr\"\u003edisplay_errors\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003eon\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003edisplay_startup_errors\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003eon\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003elog_errors\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003eon\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eerror_log\u003c/span\u003e = /var/log/php/php-error.log\n\u003cspan class=\"hljs-attr\"\u003edefault_charset\u003c/span\u003e = UTF-\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e\n\n\u003cspan class=\"hljs-section\"\u003e[Date]\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003edate.timezone\u003c/span\u003e = Asia/Tokyo\n\n\u003cspan class=\"hljs-section\"\u003e[mysqlnd]\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003emysqlnd.collect_memory_statistics\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003eon\u003c/span\u003e\n\n\u003cspan class=\"hljs-section\"\u003e[Assertion]\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003ezend.assertions\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\n\u003cspan class=\"hljs-section\"\u003e[mbstring]\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003embstring.language\u003c/span\u003e = Japanese\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eこちらの記事の開発用php.iniをまるっとお借りしました。\u003cbr\u003e開発用 / 本番用の設定例と、項目ごとの説明も載っていて面白かったので、ぜひご覧ください。\u003cbr\u003e参考記事：\u003ca href=\"https://qiita.com/ucan-lab/items/0d74378e1b9ba81699a9\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ePHP7.4 ぼくのかんがえたさいきょうのphp.ini - Qiita\u003c/a\u003e \u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h2c3fab92b5\"\u003e PHPコンテナを起動する\u003c/h2\u003e\u003cp\u003e\u003cbr\u003eここまででPHPのコンテナの準備が出来たので、実際に起動してみます。\u003cbr\u003e\u003cbr\u003edocker-sompose.ymlのあるディレクトリで以下のコマンドを実行します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e$ docker-compose up -d \u003cspan class=\"hljs-comment\"\u003e--build\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003edocker compose up\u003c/code\u003e は \u003ccode\u003edocker-compose.yml\u003c/code\u003e に定義したサービスを起動します。   \u003c/li\u003e\u003cli\u003e  \u003ccode\u003e-d\u003c/code\u003eデタッチド」モードでコンテナを起動します。\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;（デフォルトは「アタッチド」モードで全てのコンテナログを画面上に表示する。「デタッチド」モードではバックグラウンドで動作する。）\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003e--build\u003c/code\u003e コンテナの開始前にイメージをビルドします。  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;（特に変更がない場合はキャッシュが使用される。）\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e※ \u003ccode\u003e$ docker-compose build\u003c/code\u003e → \u003ccode\u003e$ docker-compose up -d\u003c/code\u003e を順に行うのと同じです。   \u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"hbdb8067534\"\u003e 起動したコンテナを確認する\u003c/h3\u003e\u003cp\u003e以下のコマンドで起動中のコンテナを一覧で確認することができます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-variable\"\u003e$\u003c/span\u003e docker\u003cspan class=\"hljs-literal\"\u003e-compose\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eps\u003c/span\u003e\n\nNAME\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;COMMAND\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;SERVICE\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;STATUS\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;PORTS\ndocker_sample\u003cspan class=\"hljs-literal\"\u003e-app-1\u003c/span\u003e\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-string\"\u003e\"docker-php-entrypoi…\"\u003c/span\u003e\u0026nbsp;\u0026nbsp;app\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;running\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-number\"\u003e9000\u003c/span\u003e/tcp\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eSTATUSがrunningになっていれば正常に起動しています。\u003cbr\u003e\u003cbr\u003e今はPHPのコンテナしか作っていないので1つだけ表示されていますが、この後nginx, MySQLのコンテナを作り、最終的に3つのコンテナが表示されるようにします。\u003cbr\u003e\u003cbr\u003eここで今作業しているディレクトリの構成を確認してみます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e$ tree\n.\n├── src\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e 作成された！\n├── docker\n│\u0026nbsp;\u0026nbsp;├── app\n│\u0026nbsp;\u0026nbsp;│\u0026nbsp;\u0026nbsp;├── Dockerfile\n│\u0026nbsp;\u0026nbsp;│\u0026nbsp;\u0026nbsp;└── php.ini\n└── docker-compose.yml\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eするとdocker-compose.ymlに書いたバインドマウントの以下の部分を受けて、コンテナを起動したときに自動でsrcディレクトリが作成されたことが確認できます。（同様にコンテナ内にもappディレクトリが作成されています。）\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003evolumes:\n\u0026nbsp;- .\u003cspan class=\"hljs-regexp\"\u003e/src/\u003c/span\u003e:/app\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"h4353a13706\"\u003e コンテナの中に入ってみる\u003c/h3\u003e\u003cp\u003e\u003cbr\u003eコンテナを起動中に以下のコマンドを実行すると、コンテナの中に入ってbashを実行することができます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e$ docker-compose exec app bash\n\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e appの部分はサービス名を指定する\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eこれで今コンテナの中に入れたので、Dockerfileの記述通りにコンテナが作られているか、またPHP・Composer・インストールした拡張機能が使えるか確認していきます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e Dockerfileの「WORKDIR /app」で指定したカレントディレクトリ通りか確認\n[app]:/app$ pwd\n/app\n\n\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e PHPのバージョン確認\n[app]:/app$ php -v\nPHP \u003cspan class=\"hljs-number\"\u003e8.0\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e (cli) (built: Jan \u003cspan class=\"hljs-number\"\u003e26\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2022\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e38\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e36\u003c/span\u003e) ( NTS )\nCopyright (c) The PHP Group\nZend Engine v4.\u003cspan class=\"hljs-number\"\u003e0.15\u003c/span\u003e, Copyright (c) Zend Technologies\n\n\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e Composerのバージョン確認\n[app]:/app$ composer -v\n\u0026nbsp;\u0026nbsp;______\n\u0026nbsp;\u003cspan class=\"hljs-regexp\"\u003e/ ____/\u003c/span\u003e___\u0026nbsp;____ ___\u0026nbsp;____\u0026nbsp;____\u0026nbsp;________\u0026nbsp;_____\n\u0026nbsp;\u003cspan class=\"hljs-regexp\"\u003e/ /\u003c/span\u003e\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-regexp\"\u003e/ __ \\/ __ `__ \\/ __ \\/ __ \\/ ___/\u003c/span\u003e _ \\\u003cspan class=\"hljs-regexp\"\u003e/ ___/\u003c/span\u003e\n\u003cspan class=\"hljs-regexp\"\u003e/ /\u003c/span\u003e___\u003cspan class=\"hljs-regexp\"\u003e/ /\u003c/span\u003e_\u003cspan class=\"hljs-regexp\"\u003e/ /\u003c/span\u003e \u003cspan class=\"hljs-regexp\"\u003e/ /\u003c/span\u003e \u003cspan class=\"hljs-regexp\"\u003e/ /\u003c/span\u003e \u003cspan class=\"hljs-regexp\"\u003e/ /\u003c/span\u003e_\u003cspan class=\"hljs-regexp\"\u003e/ /\u003c/span\u003e \u003cspan class=\"hljs-regexp\"\u003e/_/\u003c/span\u003e (__\u0026nbsp;)\u0026nbsp;__\u003cspan class=\"hljs-regexp\"\u003e/ /\u003c/span\u003e\n\\____\u003cspan class=\"hljs-regexp\"\u003e/\\____/\u003c/span\u003e_\u003cspan class=\"hljs-regexp\"\u003e/ /\u003c/span\u003e_\u003cspan class=\"hljs-regexp\"\u003e/ /\u003c/span\u003e_\u003cspan class=\"hljs-regexp\"\u003e/ .___/\u003c/span\u003e\\____\u003cspan class=\"hljs-regexp\"\u003e/____/\u003c/span\u003e\\___\u003cspan class=\"hljs-regexp\"\u003e/_/\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-regexp\"\u003e/_/\u003c/span\u003e\nComposer version \u003cspan class=\"hljs-number\"\u003e2.0\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e03\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e37\u003c/span\u003e\n\n\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e gitのバージョン確認\n[app]:/app$ git --version\ngit version \u003cspan class=\"hljs-number\"\u003e2.30\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\n\n\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e インストール済の拡張機能の一覧\n[app]:/app$ php -m\n[PHP Modules]\nbcmath\nintl\npdo_mysql\nzip\n\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e たくさん出てくるので他は省略\n\n\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e php.iniがコピー出来ているか確認\n[app]:\u003cspan class=\"hljs-regexp\"\u003e/app$ cat /u\u003c/span\u003esr\u003cspan class=\"hljs-regexp\"\u003e/local/\u003c/span\u003eetc\u003cspan class=\"hljs-regexp\"\u003e/php/\u003c/span\u003ephp.ini\nzend.exception_ignore_args = off\nexpose_php = on\nmax_execution_time = \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e\nmax_input_vars = \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e\nupload_max_filesize = \u003cspan class=\"hljs-number\"\u003e64\u003c/span\u003eM\npost_max_size = \u003cspan class=\"hljs-number\"\u003e128\u003c/span\u003eM\nmemory_limit = \u003cspan class=\"hljs-number\"\u003e256\u003c/span\u003eM\nerror_reporting = E_ALL\ndisplay_errors = on\ndisplay_startup_errors = on\nlog_errors = on\nerror_log = \u003cspan class=\"hljs-regexp\"\u003e/var/\u003c/span\u003elog\u003cspan class=\"hljs-regexp\"\u003e/php/\u003c/span\u003ephp-error.log\ndefault_charset = UTF-\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e\n\n[Date]\ndate.timezone = Asia/Tokyo\n\n[mysqlnd]\nmysqlnd.collect_memory_statistics = on\n\n[Assertion]\nzend.assertions = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\n[mbstring]\nmbstring.language = Japaneseroot@\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ee3ba825df88\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e確認できたのでコンテナを抜けます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e$ \u003cspan class=\"hljs-keyword\"\u003eexit\u003c/span\u003e\n\n\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e もしくは ctrl + d\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"hb30552acef\"\u003e コンテナの外からコマンドを実行する\u003c/h3\u003e\u003cp\u003e上記のコンテナの中で実行したコマンドは、 \u003ccode\u003e$ docker-compose exec サービス名 実行したいコマンド\u003c/code\u003e でコンテナの外から実行することもできます。（コンテナが起動中に限る）  \u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"hbe7ef0b1fb\"\u003e バインドマウントの挙動を確認する\u003c/h3\u003e\u003cp\u003eコンテナの外からコマンドが実行できるという確認も兼ねて、バインドマウントの動きを見る為、試しに以下のコマンドを実行してみます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e// コンテナ内の/app配下にファイルを作ってみる\n\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003edocker-compose \u003cspan class=\"hljs-built_in\"\u003eexec\u003c/span\u003e app \u003cspan class=\"hljs-built_in\"\u003etouch\u003c/span\u003e sample.php\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003edocker-compose \u003cspan class=\"hljs-built_in\"\u003eexec\u003c/span\u003e app \u003cspan class=\"hljs-built_in\"\u003epwd\u003c/span\u003e\u003c/span\u003e\n/app\n\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003edocker-compose \u003cspan class=\"hljs-built_in\"\u003eexec\u003c/span\u003e app \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\u003c/span\u003e\nsample.php\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eコンテナ内の/app配下にファイルを作成しました。\u003cbr\u003e\u003cbr\u003eこの/appという場所は、docker-compose.ymlに書いた以下の記述の通りにバインドマウントされています。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003evolumes:\n\u0026nbsp;- .\u003cspan class=\"hljs-regexp\"\u003e/src/\u003c/span\u003e:/app\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eこれにより、プロジェクトディレクトリ配下の/srcにもsample.phpが作成されています。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-variable\"\u003e$\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e src\nsample.php\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e以上より、コンテナ内の \u003ccode\u003e/app\u003c/code\u003e に対して行ったことが、プロジェクトの \u003ccode\u003e/src\u003c/code\u003e に反映していることが分かりました。   \u003cbr\u003e\u003cbr\u003eでは次に \u003ccode\u003e/src\u003c/code\u003e への変更がコンテナ内の \u003ccode\u003e/app\u003c/code\u003e に対しても反映するか試してみます。   \u003cbr\u003e\u003cbr\u003e\u0026nbsp;\u003ccode\u003e/src/sample.php\u003c/code\u003e をエディタで開いてファイルに \u003ccode\u003ehello\u003c/code\u003e と書きこみ、以下のコマンドを実行します。   \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003edocker-compose \u003cspan class=\"hljs-built_in\"\u003eexec\u003c/span\u003e app \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e sample.php\u003c/span\u003e\nhello\n\n// この時permission errorが出たら権限を変更する\n\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003esudo \u003cspan class=\"hljs-built_in\"\u003echmod\u003c/span\u003e -R 777 ./src\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eするとコンテナ内の \u003ccode\u003e./app/sample.php\u003c/code\u003e も編集されていることがわかります。  \u003cbr\u003e\u003cbr\u003eこのようにバインドマウントにより、ホスト側のディレクトリがコンテナ内へマウント出来ていることも確認できました。\u003cbr\u003e\u003cbr\u003e試しに作成したファイルは不要なので消しておきます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003erm\u003c/span\u003e src/sample.php\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch1 id=\"h3a503e139b\"\u003e nginxのコンテナ（webサーバー）\u003c/h1\u003e\u003cp\u003ewebサーバーとなるnginxのコンテナを作成します。\u003cbr\u003e\u003cbr\u003ePHPコンテナのときと同じく、\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e docker-compose.ymlへの記述\u003c/li\u003e\u003cli\u003e nginxコンテナ用のDockerfile\u003c/li\u003e\u003cli\u003e nginxコンテナ用の設定ファイル（default.conf）\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003eの流れで説明します。\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"hc888d0dee3\"\u003e docker-compose.yml（nginx）\u003c/h2\u003e\u003cp\u003e\u003cbr\u003e既に作成しているdocker-compose.ymlに、nginxのコンテナについての部分を追記します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-symbol\"\u003eservices:\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\u0026nbsp;api:\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// 中略\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\t\n\u0026nbsp;web:\u003c/span\u003e\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-comment\"\u003e// サービス名\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\u0026nbsp;\u0026nbsp;build:\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;context:\u003c/span\u003e .\n\u003cspan class=\"hljs-symbol\"\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;dockerfile:\u003c/span\u003e .\u003cspan class=\"hljs-keyword\"\u003e/docker/\u003c/span\u003eweb/Dockerfile\n\u003cspan class=\"hljs-symbol\"\u003e\u0026nbsp;\u0026nbsp;ports:\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;- \u003cspan class=\"hljs-number\"\u003e8081\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\u0026nbsp;\u0026nbsp;depends_on:\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;- app\n\u003cspan class=\"hljs-symbol\"\u003e\u0026nbsp;\u0026nbsp;volumes:\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;- .\u003cspan class=\"hljs-keyword\"\u003e/src/\u003c/span\u003e:/app\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e解説していきます。\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003ebuild:\u003c/code\u003e ・\u003ccode\u003evolumes:\u003c/code\u003e  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;ここはPHPコンテナと同様なので説明は省きます。\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e\u003ccode\u003eports:\u003c/code\u003e  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;ホスト側とコンテナ間のポート番号の対応付けを設定します。\u003cbr\u003e\u0026nbsp;\u0026nbsp;書き方は \u003ccode\u003eホスト側のポート番号 : コンテナのポート番号\u003c/code\u003eです。  \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;※今回ホスト側（自分のPC）は既に他の開発で使っているポートとの兼ね合いで \u003ccode\u003e8081\u003c/code\u003e を使いました。コンテナ側はnginxのデフォルトのポート番号である \u003ccode\u003e80\u003c/code\u003e にしています。   \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003edepends_on:\u003c/code\u003e  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;サービスの起動順序を制御します。\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003ccode\u003eweb\u003c/code\u003e の \u003ccode\u003edepends_on\u003c/code\u003e に \u003ccode\u003eapp\u003c/code\u003e と書いているので、 \u003ccode\u003eapp\u003c/code\u003e → \u003ccode\u003eweb\u003c/code\u003e の順に起動するように指定しています。      \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;※但しこの記述なしで \u003ccode\u003e$ docker-compose up -d --build\u003c/code\u003e をしてみても私の環境では全く問題なく動きました。が、サービス同士の依存関係を明示的に記すという意味でも書いておくに越したことはないという判断で書いています。  \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;※ nginxとphp間でTCPによるfpm接続についてや、\u003ccode\u003edepends_on\u003c/code\u003e オプションについては以下の記事がすごく勉強になったので是非読んでみてください。  \u003cbr\u003e\u0026nbsp;\u0026nbsp;参考記事：\u003ca href=\"https://qiita.com/haruyanhopemucci/items/344f1e2fb95ed452bdb2#%E5%90%84%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%8C%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E5%90%8D%E3%81%AE%E5%90%8D%E5%89%8D%E8%A7%A3%E6%B1%BA%E3%82%92%E5%BF%85%E8%A6%81%E3%81%A8%E3%81%99%E3%82%8B%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e【docker-compose】dependsonとサービス名解決にまつわるエトセトラ - Qiita\u003c/a\u003e \u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h5a107e8b8a\"\u003e Dockerfile（nginx）\u003c/h2\u003e\u003cp\u003e\u003cbr\u003e作成するDockerfileの全文はこちらです。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e nginx:\u003cspan class=\"hljs-number\"\u003e1.20\u003c/span\u003e-alpine\n\nENV TZ Asia/Tokyo\n\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e .\u003cspan class=\"hljs-regexp\"\u003e/docker/\u003c/span\u003eweb\u003cspan class=\"hljs-regexp\"\u003e/default.conf /\u003c/span\u003eetc\u003cspan class=\"hljs-regexp\"\u003e/nginx/\u003c/span\u003econf.d/\u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e.conf\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u0026nbsp;\u003ccode\u003eFROM\u003c/code\u003e , \u003ccode\u003eENV\u003c/code\u003e , \u003ccode\u003eCOPY\u003c/code\u003e の意味はPHPコンテナのDockerfileと同様なので詳しい説明は省略し、このファイルで設定していることを簡単にまとめます。    \u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e nginx公式のイメージ（Alpineベース）をベースイメージに使用\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003ca href=\"https://hub.docker.com/_/nginx\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eNginx - Official Image | Docker Hub\u003c/a\u003e \u003cbr\u003e参考記事：\u003ca href=\"https://charlie1012.hatenablog.jp/entry/2021/01/14/090000\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eDockerでよく利用されているAlpineは他のLinuxディストリビューションと比べて、どれだけ軽量なのか - プログラミングは芸術だ！\u003c/a\u003e  \u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e 環境変数のタイムゾーンを設定する\u003c/li\u003e\u003cli\u003e nginxの設定ファイル（default.conf）をコンテナ内にバインドマウント\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003e※ちなみにnginxは1.18, 1.20などの偶数バージョンが安定バージョンであり、安定バージョンの使用を推奨されています。\u003cbr\u003e公式ドキュメント：\u003ca href=\"https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/#stablevsmainline\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eInstalling NGINX Open Source\u003c/a\u003e \u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h833dd2537f\"\u003e 設定ファイル（default.conf）\u003c/h2\u003e\u003cp\u003e\u003cbr\u003e\u003ccode\u003e./docker/web/default.conf\u003c/code\u003eを作成します。  \u003cbr\u003eLaravel公式に用意されているnginxの設定例をべースに使います。\u003cbr\u003e\u003ca href=\"https://readouble.com/laravel/8.x/ja/deployment.html\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eLaravel 8.x デプロイ\u003c/a\u003e \u003cbr\u003e\u003cbr\u003e\u0026nbsp;\u003ccode\u003eroot\u003c/code\u003e と\u003ccode\u003efastcgi_pass\u003c/code\u003eの設定のみ、このプロジェクトに合わせて書き換えています。   \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003eserver {\n\u0026nbsp;\u0026nbsp;listen \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e;\n\u0026nbsp;\u0026nbsp;server_name example.com;\n\u0026nbsp;\u0026nbsp;root /app/public;\u0026nbsp;\u0026nbsp;// 書き換え\n\n\u0026nbsp;\u0026nbsp;add_header X-Frame-Options \u003cspan class=\"hljs-string\"\u003e\"SAMEORIGIN\"\u003c/span\u003e;\n\u0026nbsp;\u0026nbsp;add_header X-XSS-Protection \u003cspan class=\"hljs-string\"\u003e\"1; mode=block\"\u003c/span\u003e;\n\u0026nbsp;\u0026nbsp;add_header X-Content-\u003cspan class=\"hljs-keyword\"\u003eType\u003c/span\u003e-Options \u003cspan class=\"hljs-string\"\u003e\"nosniff\"\u003c/span\u003e;\n\n\u0026nbsp;\u0026nbsp;index index.php;\n\n\u0026nbsp;\u0026nbsp;charset utf-\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e;\n\n\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-keyword\"\u003elocation\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003e/ {\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;try_files\u003c/span\u003e $uri $uri/ /index.php?$query_string;\n\u0026nbsp;\u0026nbsp;}\n\n\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-keyword\"\u003elocation\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003e= /favicon\u003c/span\u003e.ico { access_log off; log_not_found off; }\n\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-keyword\"\u003elocation\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003e= /robots\u003c/span\u003e.txt\u0026nbsp;{ access_log off; log_not_found off; }\n\n\u0026nbsp;\u0026nbsp;error_page \u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e /index.php;\n\n\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-keyword\"\u003elocation\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003e~ \\.php\u003c/span\u003e$ {\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;fastcgi_pass app:\u003cspan class=\"hljs-number\"\u003e9000\u003c/span\u003e;\u0026nbsp;\u0026nbsp;// 書き換え\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;include fastcgi_params;\n\u0026nbsp;\u0026nbsp;}\n\n\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-keyword\"\u003elocation\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003e~ /\\.(?!well-known\u003c/span\u003e).* {\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-keyword\"\u003edeny\u003c/span\u003e all;\n\u0026nbsp;\u0026nbsp;}\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003eroot\u003c/code\u003e \u003c/li\u003e\u003c/ul\u003e\u003cp\u003eリクエストのルートディレクトリです。\u003cbr\u003e\u003ccode\u003eroot /app/public;\u003c/code\u003e と書いたので、 \u003ccode\u003elocalhost:8081\u003c/code\u003e（docker-compose.ymlで設定したポート番号）にアクセスすると \u003ccode\u003e/app/public\u003c/code\u003eを見に行きます。   \u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003efastcgi_pas\u003c/code\u003e\u003c/li\u003e\u003c/ul\u003e\u003cp\u003eFastCGIサーバーのアドレスです。\u003cbr\u003e※FastCGI：Webサーバ上で動くプログラムを一度起動したらしばらく待機させることによって、プログラムの開始と終了にかかる手間を減らし、動きを速くしたりWebサーバの負荷を軽減することができる仕組み。\u003cbr\u003e\u003ccode\u003eapp:9000;\u003c/code\u003e と書いたので、appコンテナの9000番ポートを指定しています。  \u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"hf271decc8d\"\u003e nginxコンテナを起動する\u003c/h2\u003e\u003cp\u003enginxのコンテナの準備が出来たので、また実際に起動してみます。\u003cbr\u003e\u003cbr\u003edocker-sompose.ymlのあるディレクトリで以下のコマンドを実行します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e$ docker-compose up -d \u003cspan class=\"hljs-comment\"\u003e--build\u003c/span\u003e\n\n$ docker-compose ps\nNAME\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;COMMAND\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;SERVICE\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;STATUS\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;PORTS\ndocker_sample-app\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-string\"\u003e\"docker-php-entrypoi…\"\u003c/span\u003e\u0026nbsp;\u0026nbsp;app\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-built_in\"\u003erunning\u003c/span\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-number\"\u003e9000\u003c/span\u003e/tcp\ndocker_sample-web\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-string\"\u003e\"/docker-entrypoint.…\"\u003c/span\u003e\u0026nbsp;\u0026nbsp;web\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-built_in\"\u003erunning\u003c/span\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e8081\u003c/span\u003e-\u0026gt;\u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e/tcp\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eapi（PHPのコンテナ）、web（nginxのコンテナ）の2つが起動できました。\u003cbr\u003e\u003cbr\u003eまたdocker_sample-web-1の \u003ccode\u003ePORTS\u003c/code\u003e が \u003ccode\u003e0.0.0.0:8081-\u0026gt;80/tcp\u003c/code\u003e となっており、ホスト上の8081番ポートをコンテナの80番ポートへ割り当てられていることも確認できます。   \u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"h8f15037b6a\"\u003e コンテナの動作確認\u003c/h3\u003e\u003cp\u003e\u003cbr\u003enginxのバージョンを確認します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003edocker-compose \u003cspan class=\"hljs-built_in\"\u003eexec\u003c/span\u003e web nginx -v\u003c/span\u003e\nnginx version: nginx/1.20.2\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eコンテナの中に入ってみます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e$ docker-compose \u003cspan class=\"hljs-keyword\"\u003eexec\u003c/span\u003e web bash\nOCI runtime \u003cspan class=\"hljs-keyword\"\u003eexec\u003c/span\u003e failed: \u003cspan class=\"hljs-keyword\"\u003eexec\u003c/span\u003e failed: container_linux.go:\u003cspan class=\"hljs-number\"\u003e380\u003c/span\u003e: starting \u003cspan class=\"hljs-keyword\"\u003econtainer\u003c/span\u003e process caused: \u003cspan class=\"hljs-keyword\"\u003eexec\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"bash\"\u003c/span\u003e: executable \u003cspan class=\"hljs-keyword\"\u003efile\u003c/span\u003e not found \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e $PATH: unknown\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eするとエラーになりました。\u003cbr\u003eAlpineをベースとすると \u003ccode\u003ebash\u003c/code\u003e は使えず、 \u003ccode\u003eash\u003c/code\u003e や \u003ccode\u003esh\u003c/code\u003e は使えるようです。    \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e$ docker-compose exec web ash\n[\u003cspan class=\"hljs-symbol\"\u003eweb\u003c/span\u003e]:\u003cspan class=\"hljs-link\"\u003e/ $ pwd\u003c/span\u003e\n/\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e無事コンテナの中に入れました。\u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"h88903227dd\"\u003e webサーバーとしての動作確認\u003c/h3\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e リクエストに対してファイルを返しブラウザで表示できる\u003c/li\u003e\u003cli\u003e nginxのコンテナからPHPのコンテナへphpを実行させることができる\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003e上記2点を確認します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e src/public\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003etouch\u003c/span\u003e src/public/test.php\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003etest.phpを以下のように編集します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u0026lt;?php\u003c/span\u003e\u0026nbsp;\n\n\u003cspan class=\"hljs-keyword\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'test.phpです'\u003c/span\u003e;\n\u003cspan class=\"hljs-title function_ invoke__\"\u003ephpinfo\u003c/span\u003e();\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003ccode\u003ehttp://localhost:8081/test.php\u003c/code\u003e にアクセスすると以下のように表示され、webサーバーが正しく動作していることが確認できます。  \u003cbr\u003e\u003cimg src=\"https://images.microcms-assets.io/assets/bb9889e81cb24134954870eb1f2ba680/b84369391f704cafb9636049a0ac8e40/testphp.jpeg\" alt=\"\"\u003e\u003cbr\u003e試しに作成したファイルは不要なので消しておきます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-variable\"\u003e$\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erm\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003e-rf\u003c/span\u003e src/*\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch1 id=\"h92f102c3c7\"\u003e MySQLのコンテナ（データベース）\u003c/h1\u003e\u003cp\u003eデータベースのMySQLコンテナを作成します。\u003cbr\u003e\u003cbr\u003e以下の流れで説明します。\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e docker-compose.ymlへの記述\u003c/li\u003e\u003cli\u003e MySQLコンテナ用のDockerfile\u003c/li\u003e\u003cli\u003e MySQLコンテナ用の設定ファイル（my.conf）\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h6d7ad88963\"\u003e docker-compose.yml（MySQL）\u003c/h2\u003e\u003cp\u003e既に作成しているdocker-compose.ymlに、MySQLのコンテナについての部分を追記します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-attribute\"\u003eservices\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\n\t\u003c/span\u003e\n// 中略\n\n\u0026nbsp;db:\u0026nbsp;\u0026nbsp;// サービス名\n\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-attribute\"\u003ebuild\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-attribute\"\u003econtext\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-attribute\"\u003edockerfile\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./docker/db/Dockerfile\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-attribute\"\u003eports\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e3306:3306\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-attribute\"\u003eenvironment\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-attribute\"\u003eMYSQL_DATABASE\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edatabase\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-attribute\"\u003eMYSQL_USER\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003euser\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-attribute\"\u003eMYSQL_PASSWORD\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epassword\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-attribute\"\u003eMYSQL_ROOT_PASSWORD\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epassword\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-attribute\"\u003eTZ\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'Asia/Tokyo'\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-attribute\"\u003evolumes\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emysql-volume:/var/lib/mysql\u003c/span\u003e\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\n\u003cspan class=\"hljs-attribute\"\u003evolumes\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e\n\u0026nbsp;\u003cspan class=\"hljs-attribute\"\u003emysql-volume\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003ebuild:\u003c/code\u003e ・ \u003ccode\u003eports:\u003c/code\u003e   \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;既出の通りです。\u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003eenviroment:\u003c/code\u003e  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cbr\u003e\u0026nbsp;\u0026nbsp;環境変数の設定です。\u003cbr\u003e\u0026nbsp;\u0026nbsp;※名前やDB名・ユーザー名・パスワードは好きなものを設定します。\u003cbr\u003e\u0026nbsp;\u0026nbsp;※実際のプロジェクト管理では、環境変数は \u003ccode\u003e.env\u003c/code\u003e に書いて \u003ccode\u003e.gitignore\u003c/code\u003e にするなどして、重要な情報が公開されないようにします。   \u003cbr\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e MYSQL_DATABASE：DB名\u003c/li\u003e\u003cli\u003e MYSQL_USER：ユーザー名\u003c/li\u003e\u003cli\u003e MYSQL_PASSWORD：パスワード\u003c/li\u003e\u003cli\u003e MYSQL_ROO\u003cem\u003eROOT\u003c/em\u003eWORD：ルート権限のパスワード\u003c/li\u003e\u003cli\u003e TZ：時間設定（Time Zone）\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003c/p\u003e\u003cul\u003e\u003cli\u003e \u003ccode\u003evolumes:\u003c/code\u003e  \u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u0026nbsp;\u0026nbsp;考え方はPHPやnginxのコンテナ同様ですが、先ほどまではホスト側のディレクトリを書いていたところに \u003ccode\u003emysql-volume\u003c/code\u003e と書いています。  \u003cbr\u003e\u0026nbsp;\u0026nbsp;これにより `mysql-colume` という名前で作成した\u003cstrong\u003e名前付きボリューム\u003c/strong\u003eとコンテナ内を紐づけています。 \u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"h755cef0747\"\u003e Docker Volume\u003c/h3\u003e\u003cp\u003e\u0026nbsp;\u003ccode\u003eVolume\u003c/code\u003e  とは、\u003cstrong\u003eコンテナを破棄してもデータを永続的に保存できる\u003c/strong\u003eように、コンテナ外に提供されているデータの保存領域です。 \u003cbr\u003eDockerの管理下でホスト上にストレージ領域を確保しており、Linux なら \u003ccode\u003e/var/lib/docker/volumes/\u003c/code\u003e以下にあります。  \u003cbr\u003e参考記事：\u003ca href=\"unsafe:Volume\"\u003eDocker、ボリューム(Volume)について真面目に調べた - Qiita\u003c/a\u003e \u003cbr\u003e\u003cbr\u003e\u0026nbsp;\u003cstrong\u003eなぜVolumeが必要なのか？\u003c/strong\u003e \u003cbr\u003eコンテナが起動している間はDBのレコードは保存された状態が続きますが、例えば以下のようなコマンドでコンテナを新しく作り直したとするとデータベースの情報はゼロに戻ってしまいます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e コンテナ削除\n$ docker-compose down\n\n\u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e コンテナ起動\n$ docker-compose up -d\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eこれでは困るのでコンテナを破棄してもデータを残したい、、、というときにVolumesを使ってデータの永続化を行います。\u003cbr\u003e\u003cbr\u003e※ボリュームには名前付きボリュームと匿名ボリュームがありますが、通常は管理しやすい名前付きボリュームを使うと良いかと思います。\u003cbr\u003e\u003cbr\u003e名前付きボリュームを作成する場合は、データの永続化対象のコンテナに対して \u003ccode\u003evolumes:\u003c/code\u003e オプションでバインドマウントを行うだけでなく、以下のようにdocker-compose.ymlのトップレベルでボリューム名を定義します。  \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-attribute\"\u003evolumes\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e\n\u0026nbsp;\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emysql-volume:\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h7541a8019d\"\u003e Dockerfile（MySQL）\u003c/h2\u003e\u003cp\u003e作成するDockerfileの全文はこちらです。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e mysql:\u003cspan class=\"hljs-number\"\u003e8.0\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e .\u003cspan class=\"hljs-regexp\"\u003e/docker/\u003c/span\u003edb\u003cspan class=\"hljs-regexp\"\u003e/my.cnf /\u003c/span\u003eetc/my.cnf\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e内容を簡単にまとめると、\u003c/p\u003e\u003cul\u003e\u003cli\u003e 公式のMySQLイメージをベースイメージに使用\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e[Mysql - Official Image | Docker Hub](https://hub.docker.com/_/mysql)\u003c/p\u003e\u003cul\u003e\u003cli\u003e MySQLの設定ファイル（my.cnf）をコンテナ内にバインドマウント\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003e※ここで使用しているイメージではM1 Macでは動作しないという情報が見られました。どうやらOracleのMySQLチームがメンテしている \u003ccode\u003emysql/mysql-server\u003c/code\u003e のイメージだと動作するようです。  \u003cbr\u003e\u003ca href=\"https://hub.docker.com/r/mysql/mysql-server\" target=\"_blank\" rel=\"noopener noreferrer\"\u003emysql-server\u0026nbsp;| Docker Hub\u003c/a\u003e \u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h1fb4ed6e13\"\u003e 設定ファイル（my.conf）\u003c/h2\u003e\u003cp\u003e\u003ccode\u003e./docker/db/my.cnf\u003c/code\u003eを作成します。  \u003cbr\u003e\u003cbr\u003e色んな記事で作成されているmy.cnfを参考にさせていただきながら書きました。\u003cbr\u003e参考記事：\u003ca href=\"https://it-blue-collar-dairy.com/mysqlondocker-compose/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e【Docker】docker-composeでmysqlのコンテナを立てる\u003c/a\u003e \u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e 文字コード\u003c/li\u003e\u003cli\u003e タイムゾーン\u003c/li\u003e\u003cli\u003e ログ\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003eの設定を行っています。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-section\"\u003e[mysqld]\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# character\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003echaracter_set_server\u003c/span\u003e = utf8mb4\n\u003cspan class=\"hljs-attr\"\u003ecollation_server\u003c/span\u003e = utf8mb\u003cspan class=\"hljs-number\"\u003e4_0900_\u003c/span\u003eai_ci\n\n\u003cspan class=\"hljs-comment\"\u003e# timezone\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003edefault-time-zone\u003c/span\u003e = SYSTEM\n\u003cspan class=\"hljs-attr\"\u003elog_timestamps\u003c/span\u003e = SYSTEM\n\n\u003cspan class=\"hljs-comment\"\u003e# Error Log\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003elog-error\u003c/span\u003e = mysql-error.log\n\n\u003cspan class=\"hljs-comment\"\u003e# Slow Query Log\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eslow_query_log\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eslow_query_log_file\u003c/span\u003e = mysql-slow.log\n\u003cspan class=\"hljs-attr\"\u003elong_query_time\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e1.0\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003elog_queries_not_using_indexes\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# General Log\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003egeneral_log\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003egeneral_log_file\u003c/span\u003e = mysql-general.log\n\n\u003cspan class=\"hljs-section\"\u003e[mysql]\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003edefault-character-set\u003c/span\u003e = utf8mb4\n\n\u003cspan class=\"hljs-section\"\u003e[client]\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003edefault-character-set\u003c/span\u003e = utf8mb4\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h067ee63297\"\u003e MySQLコンテナを起動する\u003c/h2\u003e\u003cp\u003eMySQLのコンテナの準備が出来たので、また実際に起動してみます。\u003cbr\u003e\u003cbr\u003edocker-sompose.ymlのあるディレクトリで以下のコマンドを実行します。\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e$ docker-compose up -d \u003cspan class=\"hljs-comment\"\u003e--build\u003c/span\u003e\n\n$ docker-compose ps\nNAME\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;COMMAND\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;SERVICE\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;STATUS\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;PORTS\ndocker_sample-app\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-string\"\u003e\"docker-php-entrypoi…\"\u003c/span\u003e\u0026nbsp;\u0026nbsp;app\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-built_in\"\u003erunning\u003c/span\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-number\"\u003e9000\u003c/span\u003e/tcp\ndocker_sample-db\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-string\"\u003e\"docker-entrypoint.s…\"\u003c/span\u003e\u0026nbsp;\u0026nbsp;db\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-built_in\"\u003erunning\u003c/span\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e3306\u003c/span\u003e-\u0026gt;\u003cspan class=\"hljs-number\"\u003e3306\u003c/span\u003e/tcp\ndocker_sample-web\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-string\"\u003e\"/docker-entrypoint.…\"\u003c/span\u003e\u0026nbsp;\u0026nbsp;web\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-built_in\"\u003erunning\u003c/span\u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u003cspan class=\"hljs-number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e8081\u003c/span\u003e-\u0026gt;\u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e/tcp\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eapi（PHPのコンテナ）、web（nginxのコンテナ）、db（MySQLのコンテナ）の3つが起動できました。\u003cbr\u003e\u003c/p\u003e\u003ch3 id=\"h42e7c9d39f\"\u003eコンテナの動作確認\u003c/h3\u003e\u003cp\u003eMySQLのバージョンを確認します。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-comment\"\u003e$ docker compose exec db\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003emysql\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003e-\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003eV\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003emysql\u0026nbsp;Ver\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e8\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e0\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e28 for Linux on x86_64\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e(MySQL\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003eCommunity\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003eServer\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003eGPL)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e※この後Laravelのプロジェクトを作成したら、このDBとLaravelを接続します。\u003cbr\u003eそしてマイグレーションを行ってDBにテーブルを作成してから、MySQLにログインしてDBを使う動作確認をしたいと思います。\u003cbr\u003e\u003c/p\u003e\u003ch1 id=\"hd865058a4e\"\u003e Laravelのインストール\u003c/h1\u003e\u003ch2 id=\"h6742e995c9\"\u003e Laravelプロジェクトの作成\u003c/h2\u003e\u003cp\u003e\u003cbr\u003eLEMP環境が構築できたので、Laravelのアプリケーションを作っていきます。\u003cbr\u003e\u003cbr\u003eappコンテナに入り、Laravelをインストールします。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e$ \u003cspan class=\"hljs-string\"\u003edocker\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecompose\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eexec\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eapp\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebash\u003c/span\u003e\n[\u003cspan class=\"hljs-string\"\u003eapp\u003c/span\u003e]:/\u003cspan class=\"hljs-string\"\u003eapp\u003c/span\u003e$ \u003cspan class=\"hljs-string\"\u003ecomposer\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecreate-project\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003e--prefer-dist\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"laravel/laravel=8.*\"\u003c/span\u003e .\n[\u003cspan class=\"hljs-string\"\u003eapp\u003c/span\u003e]:/\u003cspan class=\"hljs-string\"\u003eapp\u003c/span\u003e$ \u003cspan class=\"hljs-string\"\u003ephp\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eartisan\u003c/span\u003e -\u003cspan class=\"hljs-string\"\u003ev\u003c/span\u003e\n\u003cspan class=\"hljs-string\"\u003eLaravel\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eFramework\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e8\u003c/span\u003e.\u003cspan class=\"hljs-string\"\u003e81\u003c/span\u003e.\u003cspan class=\"hljs-string\"\u003e0\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003eコンテナ内の/app配下にLaravelのプロジェクトが新規作成され、ホスト側の/src配下にも同じくLaravelのプロジェクトが出来ました。\u003cbr\u003e\u003cbr\u003e\u003ccode\u003elocalhost:8081\u003c/code\u003eにアクセスして、ブラウザでもLaravelのウェルカムページが表示できることを確認します。  \u003cbr\u003e\u003cimg src=\"https://images.microcms-assets.io/assets/bb9889e81cb24134954870eb1f2ba680/6328bcf6dfe64db7aff89f42adf30e00/laravel.jpeg\" alt=\"\"\u003e\u003c/p\u003e\u003ch2 id=\"h33b0e81c46\"\u003e DB接続\u003c/h2\u003e\u003cp\u003eappコンテナ（Laravel）からdbコンテナ（MySQL）へ接続する設定を行います。\u003cbr\u003e\u003cbr\u003eLaravelではデータベースへの接続設定を \u003ccode\u003e.env\u003c/code\u003e ファイルに定義しているので、 \u003ccode\u003e/src/.env\u003c/code\u003e のDBの部分を以下のように修正します。   \u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-attr\"\u003eDB_CONNECTION\u003c/span\u003e=mysql\n\u003cspan class=\"hljs-attr\"\u003eDB_HOST\u003c/span\u003e=db\u0026nbsp;\u0026nbsp;// MySQLコンテナのサービス名\n\u003cspan class=\"hljs-attr\"\u003eDB_PORT\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e3306\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eDB_DATABASE\u003c/span\u003e=database\n\u003cspan class=\"hljs-attr\"\u003eDB_USERNAME\u003c/span\u003e=root\n\u003cspan class=\"hljs-attr\"\u003eDB_PASSWORD\u003c/span\u003e=passwor\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e  \u003ccode\u003eDB_HOST\u003c/code\u003eはMySQLコンテナのサービス名を指定します。 \u003c/li\u003e\u003cli\u003e その他の項目もMySQLコンテナで設定した値（今回はdocker-compose.ymlのenviromentで定義）と同じ値を指定します。\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cbr\u003eDBに接続出来ているか確認する為、以下のコマンドを実行してマイグレーションを行います。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e$ docker compose exec app bash\n\u003cspan class=\"hljs-section\"\u003e[app]:/app$ php artisan migrate\u003c/span\u003e\nMigration table created successfully.\n\u003cspan class=\"hljs-section\"\u003eMigrating: 2014_10_12_000000_create_users_table\u003c/span\u003e\n\u003cspan class=\"hljs-section\"\u003eMigrated:\u0026nbsp;2014_10_12_000000_create_users_table (55.42ms)\u003c/span\u003e\n\u003cspan class=\"hljs-section\"\u003eMigrating: 2014_10_12_100000_create_password_resets_table\u003c/span\u003e\n\u003cspan class=\"hljs-section\"\u003eMigrated:\u0026nbsp;2014_10_12_100000_create_password_resets_table (51.11ms)\u003c/span\u003e\n\u003cspan class=\"hljs-section\"\u003eMigrating: 2019_08_19_000000_create_failed_jobs_table\u003c/span\u003e\n\u003cspan class=\"hljs-section\"\u003eMigrated:\u0026nbsp;2019_08_19_000000_create_failed_jobs_table (45.12ms)\u003c/span\u003e\n\u003cspan class=\"hljs-section\"\u003eMigrating: 2019_12_14_000001_create_personal_access_tokens_table\u003c/span\u003e\n\u003cspan class=\"hljs-section\"\u003eMigrated:\u0026nbsp;2019_12_14_000001_create_personal_access_tokens_table (75.74ms)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"hf98e955142\"\u003e MySQLを使ってみる\u003c/h2\u003e\u003cp\u003eMySQLのコンテナに入ってDBを確認してみます。\u003cbr\u003e\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs\"\u003e$ docker-compose exec db bash\n[db]:/$ mysql -u root -p\n\u003cspan class=\"hljs-comment\"\u003e// パスワードを求められるので入力\u003c/span\u003e\n[db] mysql\u0026gt; use database;\n[db] mysql\u0026gt; show tables;\n\u003cspan class=\"hljs-code\"\u003e+------------------------+\u003c/span\u003e\n\u003cspan class=\"hljs-section\"\u003e| Tables_in_database\u0026nbsp;\u0026nbsp;\u0026nbsp;|\n+------------------------+\u003c/span\u003e\n| failed\u003cspan class=\"hljs-emphasis\"\u003e_jobs\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;|\n| migrations\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;|\n| password_resets\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;|\n| personal_access_\u003c/span\u003etokens |\n\u003cspan class=\"hljs-section\"\u003e| users\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;|\n+------------------------+\u003c/span\u003e\n5 rows in set (0.00 sec)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cbr\u003e先ほどマイグレーションを実行したので、Laravelのデフォルトで用意されているマイグレーションファイル通りにテーブルが作成されていることが確認できました。\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h9b4c4b9dd7\"\u003e 最後に\u003c/h2\u003e\u003cp\u003eこれでDocker（Docker Compose）を使ったLEMP環境の構築が完了です。\u003cbr\u003e\u003cbr\u003e今回作成した環境は非常にシンプルなものなので、業務で使うとなるともっと設定を細やかに行ったり、開発環境・ステージング環境・本番環境それぞれの設定ファイルを用意して設定を切り替えたりといった作業が必要になるかと思いますが、仕組みが分かればあとは全てこの延長にあるのかなと思います。\u003cbr\u003e\u003cbr\u003eまたいずれ環境ごとの設定ファイル切り替えだったり、あとはNodeのコンテナを使ってNext.jsの環境構築もやってみたいです。\u003cbr\u003e\u003c/p\u003e\u003ch2 id=\"h3937880ed1\"\u003e 参考記事\u003c/h2\u003e\u003cp\u003e\u003cbr\u003e\u003ca href=\"https://yutaro-blog.net/2021/04/29/docker-laravel-vuejs-2/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ehttps://yutaro-blog.net/2021/04/29/docker-laravel-vuejs-2/\u003c/a\u003e\u003cbr\u003e\u003cbr\u003e\u003ca href=\"https://yutaro-blog.net/2021/04/30/docker-laravel-vuejs-3/#index_id11\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ehttps://yutaro-blog.net/2021/04/30/docker-laravel-vuejs-3/#index_id11\u003c/a\u003e\u003cbr\u003e\u003cbr\u003e\u003ca href=\"https://qiita.com/ucan-lab/items/56c9dc3cf2e6762672f4\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ehttps://qiita.com/ucan-lab/items/56c9dc3cf2e6762672f4\u003c/a\u003e\u003cbr\u003e\u003c/p\u003e\u003c/body\u003e\u003c/html\u003e"},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"docker-lemp"},"buildId":"EwuWiZmkeG3lYlO_XC9fM","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>